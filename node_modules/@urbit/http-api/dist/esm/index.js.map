{"version":3,"file":"index.js","sources":["../../src/types.ts","../../node_modules/browser-or-node/lib/index.js","../../src/fetch-event-source/parse.ts","../../src/fetch-event-source/fetch.ts","../../src/utils.ts","../../src/Urbit.ts"],"sourcesContent":["/**\n * An urbit style path, rendered as a Javascript string\n * @example\n * `\"/updates\"`\n */\nexport type Path = string;\n\n/**\n * @p including leading sig, rendered as a string\n *\n * @example\n * ```typescript\n * \"~sampel-palnet\"\n * ```\n *\n */\nexport type Patp = string;\n\n/**\n * @p not including leading sig, rendered as a string\n *\n * @example\n * ```typescript\n * \"sampel-palnet\"\n * ```\n *\n */\nexport type PatpNoSig = string;\n\n/**\n * The name of a clay mark, as a string\n *\n * @example\n * ```typescript\n * \"graph-update\"\n * ```\n */\nexport type Mark = string;\n\n/**\n * The name of a gall agent, as a string\n *\n * @example\n *\n * ```typescript\n * \"graph-store\"\n * ```\n */\nexport type GallAgent = string;\n\n/**\n * Description of an outgoing poke\n *\n * @typeParam Action - Typescript type of the data being poked\n */\nexport interface Poke<Action> {\n  /**\n   * Ship to poke. If left empty, the api lib will populate it with the ship that it is connected to.\n   *\n   * @remarks\n   *\n   * This should always be the ship that you are connected to\n   *\n   */\n  ship?: PatpNoSig;\n  /**\n   */\n  app: GallAgent;\n  /**\n   * Mark of the cage to be poked\n   *\n   */\n  mark: Mark;\n  /**\n   * Vase of the cage of to be poked, as JSON\n   */\n  json: Action;\n}\n\n/**\n * Description of a scry request\n */\nexport interface Scry {\n  /** {@inheritDoc GallAgent} */\n  app: GallAgent;\n  /** {@inheritDoc Path} */\n  path: Path;\n}\n\n/**\n * Description of a thread request\n *\n * @typeParam Action - Typescript type of the data being poked\n */\nexport interface Thread<Action> {\n  /**\n   * The mark of the input vase\n   */\n  inputMark: Mark;\n  /**\n   * The mark of the output vase\n   */\n  outputMark: Mark;\n  /**\n   * Name of the thread\n   *\n   * @example\n   * ```typescript\n   * \"graph-add-nodes\"\n   * ```\n   */\n  threadName: string;\n  /**\n   * Desk of thread\n   */\n  desk?: string;\n  /**\n   * Data of the input vase\n   */\n  body: Action;\n}\n\nexport type Action = 'poke' | 'subscribe' | 'ack' | 'unsubscribe' | 'delete';\n\nexport interface PokeHandlers {\n  onSuccess?: () => void;\n  onError?: (e: any) => void;\n}\n\nexport type PokeInterface<T> = PokeHandlers & Poke<T>;\n\nexport interface AuthenticationInterface {\n  ship: string;\n  url: string;\n  code: string;\n  verbose?: boolean;\n}\n\n/**\n * Subscription event handlers\n *\n */\nexport interface SubscriptionInterface {\n  /**\n   * Handle negative %watch-ack\n   */\n  err?(error: any, id: string): void;\n  /**\n   * Handle %fact\n   */\n  event?(data: any, mark: string, id: number): void;\n  /**\n   * Handle %kick\n   */\n  quit?(data: any): void;\n}\n\nexport type OnceSubscriptionErr = 'quit' | 'nack' | 'timeout';\n\nexport interface SubscriptionRequestInterface extends SubscriptionInterface {\n  /**\n   * The app to subscribe to\n   * @example\n   * `\"graph-store\"`\n   */\n  app: GallAgent;\n  /**\n   * The path to which to subscribe\n   * @example\n   * `\"/keys\"`\n   */\n  path: Path;\n}\n\nexport interface headers {\n  'Content-Type': string;\n  Cookie?: string;\n}\n\nexport interface CustomEventHandler {\n  (data: any, response: string): void;\n}\n\nexport interface SSEOptions {\n  headers?: {\n    Cookie?: string;\n  };\n  withCredentials?: boolean;\n}\n\nexport interface Message extends Record<string, any> {\n  action: Action;\n  id?: number;\n}\n\nexport class ResumableError extends Error {}\n\nexport class FatalError extends Error {}\n\nexport class ReapError extends Error {}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/* global window self */\n\nvar isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n\n/* eslint-disable no-restricted-globals */\nvar isWebWorker = (typeof self === 'undefined' ? 'undefined' : _typeof(self)) === 'object' && self.constructor && self.constructor.name === 'DedicatedWorkerGlobalScope';\n/* eslint-enable no-restricted-globals */\n\nvar isNode = typeof process !== 'undefined' && process.versions != null && process.versions.node != null;\n\n/**\n * @see https://github.com/jsdom/jsdom/releases/tag/12.0.0\n * @see https://github.com/jsdom/jsdom/issues/1537\n */\n/* eslint-disable no-undef */\nvar isJsDom = function isJsDom() {\n  return typeof window !== 'undefined' && window.name === 'nodejs' || navigator.userAgent.includes('Node.js') || navigator.userAgent.includes('jsdom');\n};\n\nexports.isBrowser = isBrowser;\nexports.isWebWorker = isWebWorker;\nexports.isNode = isNode;\nexports.isJsDom = isJsDom;","/**\n * Represents a message sent in an event stream\n * https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format\n */\nexport interface EventSourceMessage {\n  /** The event ID to set the EventSource object's last event ID value. */\n  id: string;\n  /** A string identifying the type of event described. */\n  event: string;\n  /** The event data */\n  data: string;\n  /** The reconnection interval (in milliseconds) to wait before retrying the connection */\n  retry?: number;\n}\n\n/**\n * Converts a ReadableStream into a callback pattern.\n * @param stream The input ReadableStream.\n * @param onChunk A function that will be called on each new byte chunk in the stream.\n * @returns {Promise<void>} A promise that will be resolved when the stream closes.\n */\nexport async function getBytes(\n  stream: ReadableStream<Uint8Array>,\n  onChunk: (arr: Uint8Array) => void,\n  responseTimeout?: number\n) {\n  const reader = stream.getReader();\n  let result: ReadableStreamReadResult<Uint8Array> = {\n    done: false,\n    value: new Uint8Array(),\n  };\n\n  while (result && !result.done) {\n    result = await Promise.race([\n      reader.read(),\n      new Promise<ReadableStreamReadResult<Uint8Array>>((_, reject) => {\n        setTimeout(\n          () => reject(new Error('getBytes timed out')),\n          responseTimeout\n        );\n      }),\n    ]);\n\n    onChunk(result.value);\n  }\n}\n\nconst enum ControlChars {\n  NewLine = 10,\n  CarriageReturn = 13,\n  Space = 32,\n  Colon = 58,\n}\n\n/**\n * Parses arbitary byte chunks into EventSource line buffers.\n * Each line should be of the format \"field: value\" and ends with \\r, \\n, or \\r\\n.\n * @param onLine A function that will be called on each new EventSource line.\n * @returns A function that should be called for each incoming byte chunk.\n */\nexport function getLines(\n  onLine: (line: Uint8Array, fieldLength: number) => void\n) {\n  let buffer: Uint8Array | undefined;\n  let position: number; // current read position\n  let fieldLength: number; // length of the `field` portion of the line\n  let discardTrailingNewline = false;\n\n  // return a function that can process each incoming byte chunk:\n  return function onChunk(arr: Uint8Array) {\n    if (buffer === undefined) {\n      buffer = arr;\n      position = 0;\n      fieldLength = -1;\n    } else {\n      // we're still parsing the old line. Append the new bytes into buffer:\n      buffer = concat(buffer, arr);\n    }\n\n    const bufLength = buffer.length;\n    let lineStart = 0; // index where the current line starts\n    while (position < bufLength) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === ControlChars.NewLine) {\n          lineStart = ++position; // skip to next char\n        }\n\n        discardTrailingNewline = false;\n      }\n\n      // start looking forward till the end of line:\n      let lineEnd = -1; // index of the \\r or \\n char\n      for (; position < bufLength && lineEnd === -1; ++position) {\n        switch (buffer[position]) {\n          case ControlChars.Colon:\n            if (fieldLength === -1) {\n              // first colon in line\n              fieldLength = position - lineStart;\n            }\n            break;\n          // @ts-ignore:7029 \\r case below should fallthrough to \\n:\n          case ControlChars.CarriageReturn:\n            discardTrailingNewline = true;\n          case ControlChars.NewLine:\n            lineEnd = position;\n            break;\n        }\n      }\n\n      if (lineEnd === -1) {\n        // We reached the end of the buffer but the line hasn't ended.\n        // Wait for the next arr and then continue parsing:\n        break;\n      }\n\n      // we've reached the line end, send it out:\n      onLine(buffer.subarray(lineStart, lineEnd), fieldLength);\n      lineStart = position; // we're now on the next line\n      fieldLength = -1;\n    }\n\n    if (lineStart === bufLength) {\n      buffer = undefined; // we've finished reading it\n    } else if (lineStart !== 0) {\n      // Create a new view into buffer beginning at lineStart so we don't\n      // need to copy over the previous lines when we get the new arr:\n      buffer = buffer.subarray(lineStart);\n      position -= lineStart;\n    }\n  };\n}\n\n/**\n * Parses line buffers into EventSourceMessages.\n * @param onId A function that will be called on each `id` field.\n * @param onRetry A function that will be called on each `retry` field.\n * @param onMessage A function that will be called on each message.\n * @returns A function that should be called for each incoming line buffer.\n */\nexport function getMessages(\n  onMessage?: (msg: EventSourceMessage) => void,\n  onId?: (id: string) => void,\n  onRetry?: (retry: number) => void\n) {\n  let message = newMessage();\n  const decoder = new TextDecoder();\n\n  // return a function that can process each incoming line buffer:\n  return function onLine(line: Uint8Array, fieldLength: number) {\n    if (line.length === 0) {\n      // empty line denotes end of message. Trigger the callback and start a new message:\n      onMessage?.(message);\n      message = newMessage();\n    } else if (fieldLength > 0) {\n      // exclude comments and lines with no values\n      // line is of format \"<field>:<value>\" or \"<field>: <value>\"\n      // https://html.spec.whatwg.org/multipage/server-sent-events.html#event-stream-interpretation\n      const field = decoder.decode(line.subarray(0, fieldLength));\n      const valueOffset =\n        fieldLength + (line[fieldLength + 1] === ControlChars.Space ? 2 : 1);\n      const value = decoder.decode(line.subarray(valueOffset));\n\n      switch (field) {\n        case 'data':\n          // if this message already has data, append the new value to the old.\n          // otherwise, just set to the new value:\n          message.data = message.data ? message.data + '\\n' + value : value; // otherwise,\n          break;\n        case 'event':\n          message.event = value;\n          break;\n        case 'id':\n          onId?.((message.id = value));\n          break;\n        case 'retry':\n          const retry = parseInt(value, 10);\n          if (!isNaN(retry)) {\n            // per spec, ignore non-integers\n            onRetry?.((message.retry = retry));\n          }\n          break;\n      }\n    }\n  };\n}\n\nfunction concat(a: Uint8Array, b: Uint8Array) {\n  const res = new Uint8Array(a.length + b.length);\n  res.set(a);\n  res.set(b, a.length);\n  return res;\n}\n\nfunction newMessage(): EventSourceMessage {\n  // data, event, and id must be initialized to empty strings:\n  // https://html.spec.whatwg.org/multipage/server-sent-events.html#event-stream-interpretation\n  // retry should be initialized to undefined so we return a consistent shape\n  // to the js engine all the time: https://mathiasbynens.be/notes/shapes-ics#takeaways\n  return {\n    data: '',\n    event: '',\n    id: '',\n    retry: undefined,\n  };\n}\n","import { FatalError, ReapError } from '../types';\nimport { EventSourceMessage, getBytes, getLines, getMessages } from './parse';\n\nexport const EventStreamContentType = 'text/event-stream';\n\nconst DefaultRetryInterval = 1000;\nconst LastEventId = 'last-event-id';\n\nexport interface FetchEventSourceInit extends RequestInit {\n  /**\n   * The request headers. FetchEventSource only supports the Record<string,string> format.\n   */\n  headers?: Record<string, string>;\n\n  /**\n   * Called when a response is received. Use this to validate that the response\n   * actually matches what you expect (and throw if it doesn't.) If not provided,\n   * will default to a basic validation to ensure the content-type is text/event-stream.\n   */\n  onopen?: (response: Response, reconnection: boolean) => Promise<void>;\n\n  /**\n   * Called when a message is received. NOTE: Unlike the default browser\n   * EventSource.onmessage, this callback is called for _all_ events,\n   * even ones with a custom `event` field.\n   */\n  onmessage?: (ev: EventSourceMessage) => void;\n\n  /**\n   * Called when a response finishes. If you don't expect the server to kill\n   * the connection, you can throw an exception here and retry using onerror.\n   */\n  onclose?: () => void;\n\n  /**\n   * Called when there is any error making the request / processing messages /\n   * handling callbacks etc. Use this to control the retry strategy: if the\n   * error is fatal, rethrow the error inside the callback to stop the entire\n   * operation. Otherwise, you can return an interval (in milliseconds) after\n   * which the request will automatically retry (with the last-event-id).\n   * If this callback is not specified, or it returns undefined, fetchEventSource\n   * will treat every error as retriable and will try again after 1 second.\n   */\n  onerror?: (err: any) => number | null | undefined | void;\n\n  /**\n   * If true, will keep the request open even if the document is hidden.\n   * By default, fetchEventSource will close the request and reopen it\n   * automatically when the document becomes visible again.\n   */\n  openWhenHidden?: boolean;\n\n  /** The Fetch function to use. Defaults to window.fetch */\n  fetch?: typeof fetch;\n\n  /** How many millisedonds to wait for bytes before timing out */\n  responseTimeout?: number;\n}\n\nexport function fetchEventSource(\n  input: RequestInfo,\n  {\n    signal: inputSignal,\n    headers: inputHeaders,\n    onopen: inputOnOpen,\n    onmessage,\n    onclose,\n    onerror,\n    openWhenHidden,\n    fetch: inputFetch,\n    responseTimeout,\n    ...rest\n  }: FetchEventSourceInit\n) {\n  return new Promise<void>((resolve, reject) => {\n    // make a copy of the input headers since we may modify it below:\n    const headers = { ...inputHeaders };\n    if (!headers.accept) {\n      headers.accept = EventStreamContentType;\n    }\n\n    let curRequestController: AbortController;\n    function onVisibilityChange() {\n      curRequestController.abort(); // close existing request on every visibility change\n      if (!document.hidden) {\n        create(); // page is now visible again, recreate request.\n      }\n    }\n\n    if (typeof document !== 'undefined' && !openWhenHidden) {\n      document.addEventListener('visibilitychange', onVisibilityChange);\n    }\n\n    let retryInterval = DefaultRetryInterval;\n    let retryTimer: ReturnType<typeof setTimeout>;\n    function dispose() {\n      if (typeof document !== 'undefined' && !openWhenHidden) {\n        document.removeEventListener('visibilitychange', onVisibilityChange);\n      }\n      clearTimeout(retryTimer);\n      curRequestController.abort();\n    }\n\n    // if the incoming signal aborts, dispose resources and resolve:\n    inputSignal?.addEventListener('abort', () => {\n      dispose();\n      resolve(); // don't waste time constructing/logging errors\n    });\n\n    const fetchFn = inputFetch ?? fetch;\n    const onopen = inputOnOpen ?? defaultOnOpen;\n    let isReconnect = false;\n    async function create() {\n      curRequestController = new AbortController();\n      try {\n        const response = (await Promise.race([\n          fetchFn(input, {\n            ...rest,\n            headers,\n            signal: curRequestController.signal,\n          }),\n          new Promise((_, reject) => {\n            setTimeout(\n              () => reject(new Error('fetch timed out')),\n              responseTimeout\n            );\n          }),\n        ])) as Response;\n\n        if (response.status === 404) {\n          onerror?.(new ReapError('Channel reaped'));\n          dispose();\n          resolve();\n          return;\n        }\n\n        if (response.status < 200 || response.status >= 300) {\n          throw new Error(`Invalid server response: ${response.status}`);\n        }\n\n        await onopen(response, isReconnect);\n        // reset reconnect status\n        if (isReconnect) {\n          isReconnect = false;\n        }\n\n        await getBytes(\n          response.body!,\n          getLines(\n            getMessages(\n              onmessage,\n              (id) => {\n                if (id) {\n                  // store the id and send it back on the next retry:\n                  headers[LastEventId] = id;\n                } else {\n                  // don't send the last-event-id header anymore:\n                  delete headers[LastEventId];\n                }\n              },\n              (retry) => {\n                retryInterval = retry;\n              }\n            )\n          ),\n          responseTimeout\n        );\n\n        onclose?.();\n        dispose();\n        resolve();\n      } catch (err) {\n        if (!curRequestController.signal.aborted) {\n          // if we haven't aborted the request ourselves:\n          try {\n            isReconnect = true;\n            // check if we need to retry:\n            const interval: any = onerror?.(err) ?? retryInterval;\n            clearTimeout(retryTimer);\n            curRequestController.abort();\n            retryTimer = setTimeout(create, interval);\n          } catch (innerErr) {\n            // we should not retry anymore:\n            dispose();\n            reject(innerErr);\n          }\n        }\n      }\n    }\n\n    create();\n  });\n}\n\nfunction defaultOnOpen(response: Response) {\n  const contentType = response.headers.get('content-type');\n  if (!contentType?.startsWith(EventStreamContentType)) {\n    throw new Error(\n      `Expected content-type to be ${EventStreamContentType}, Actual: ${contentType}`\n    );\n  }\n}\n","export function camelize(str: string) {\n  return str\n    .replace(/\\s(.)/g, function ($1: string) {\n      return $1.toUpperCase();\n    })\n    .replace(/\\s/g, '')\n    .replace(/^(.)/, function ($1: string) {\n      return $1.toLowerCase();\n    });\n}\n\nexport function uncamelize(str: string, separator = '-') {\n  // Replace all capital letters by separator followed by lowercase one\n  var str = str.replace(/[A-Z]/g, function (letter: string) {\n    return separator + letter.toLowerCase();\n  });\n  return str.replace(new RegExp('^' + separator), '');\n}\n\n/**\n * Returns a hex string of given length.\n *\n * Poached from StackOverflow.\n *\n * @param len Length of hex string to return.\n */\nexport function hexString(len: number): string {\n  const maxlen = 8;\n  const min = Math.pow(16, Math.min(len, maxlen) - 1);\n  const max = Math.pow(16, Math.min(len, maxlen)) - 1;\n  const n = Math.floor(Math.random() * (max - min + 1)) + min;\n  let r = n.toString(16);\n  while (r.length < len) {\n    r = r + hexString(len - maxlen);\n  }\n  return r;\n}\n\n/**\n * Generates a random UID.\n *\n * Copied from https://github.com/urbit/urbit/blob/137e4428f617c13f28ed31e520eff98d251ed3e9/pkg/interface/src/lib/util.js#L3\n */\nexport function uid(): string {\n  let str = '0v';\n  str += Math.ceil(Math.random() * 8) + '.';\n  for (let i = 0; i < 5; i++) {\n    let _str = Math.ceil(Math.random() * 10000000).toString(32);\n    _str = ('00000' + _str).substr(-5, 5);\n    str += _str + '.';\n  }\n  return str.slice(0, -1);\n}\n\nexport default class EventEmitter {\n  private listeners: Record<string, Function[]> = {};\n\n  on(event: string, callback: Function) {\n    if (!this.listeners.hasOwnProperty(event)) {\n      this.listeners[event] = [];\n    }\n\n    this.listeners[event].push(callback);\n\n    return this;\n  }\n\n  emit(event: string, ...data: any): any {\n    if (!this.listeners.hasOwnProperty(event)) {\n      return null;\n    }\n\n    for (let i = 0; i < this.listeners[event].length; i++) {\n      const callback = this.listeners[event][i];\n\n      callback.call(this, ...data);\n    }\n  }\n}\n","import { isBrowser, isNode } from 'browser-or-node';\nimport { UrbitHttpApiEvent, UrbitHttpApiEventType } from './events';\nimport { fetchEventSource, EventSourceMessage } from './fetch-event-source';\n\nimport {\n  Scry,\n  Thread,\n  AuthenticationInterface,\n  PokeInterface,\n  SubscriptionRequestInterface,\n  headers,\n  SSEOptions,\n  PokeHandlers,\n  Message,\n  FatalError,\n  ReapError,\n} from './types';\nimport EventEmitter, { hexString } from './utils';\n\n/**\n * A class for interacting with an urbit ship, given its URL and code\n */\nexport class Urbit {\n  /**\n   * Event emitter for debugging, see events.ts for full list of events\n   */\n  private emitter = new EventEmitter();\n\n  /**\n   * UID will be used for the channel: The current unix time plus a random hex string\n   */\n  private uid: string = `${Math.floor(Date.now() / 1000)}-${hexString(6)}`;\n\n  /**\n   * lastEventId is an auto-updated index of which events have been *sent* over this channel.\n   * lastHeardEventId is the latest event we have heard back about.\n   * lastAcknowledgedEventId is the latest event we have sent an ack for.\n   */\n  private lastEventId: number = 0;\n  private lastHeardEventId: number = -1;\n  private lastAcknowledgedEventId: number = -1;\n\n  /**\n   * SSE Client is null for now; we don't want to start polling until it the channel exists\n   */\n  private sseClientInitialized: boolean = false;\n\n  /**\n   * Cookie gets set when we log in.\n   */\n  cookie?: string | undefined;\n\n  /**\n   * A registry of requestId to successFunc/failureFunc\n   *\n   * These functions are registered during a +poke and are executed\n   * in the onServerEvent()/onServerError() callbacks. Only one of\n   * the functions will be called, and the outstanding poke will be\n   * removed after calling the success or failure function.\n   */\n\n  private outstandingPokes: Map<number, PokeHandlers> = new Map();\n\n  /**\n   * A registry of requestId to subscription functions.\n   *\n   * These functions are registered during a +subscribe and are\n   * executed in the onServerEvent()/onServerError() callbacks. The\n   * event function will be called whenever a new piece of data on this\n   * subscription is available, which may be 0, 1, or many times. The\n   * disconnect function may be called exactly once.\n   */\n  private outstandingSubscriptions: Map<number, SubscriptionRequestInterface> =\n    new Map();\n\n  /**\n   * Our abort controller, used to close the connection\n   */\n  private abort = new AbortController();\n\n  /**\n   * Identity of the ship we're connected to\n   */\n  ship?: string | null;\n\n  /**\n   * Our identity, with which we are authenticated into the ship\n   */\n  our?: string | null;\n\n  /**\n   * If verbose, logs output eagerly.\n   */\n  verbose?: boolean;\n\n  /**\n   * number of consecutive errors in connecting to the eventsource\n   */\n  private errorCount = 0;\n\n  onError?: (error: any) => void = null;\n\n  onRetry?: () => void = null;\n\n  onOpen?: () => void = null;\n\n  onReconnect?: () => void = null;\n\n  /** This is basic interpolation to get the channel URL of an instantiated Urbit connection. */\n  private get channelUrl(): string {\n    return `${this.url}/~/channel/${this.uid}`;\n  }\n\n  private get fetchOptions(): any {\n    const headers: headers = {\n      'Content-Type': 'application/json',\n    };\n    if (!isBrowser) {\n      headers.Cookie = this.cookie;\n    }\n    return {\n      credentials: 'include',\n      accept: '*',\n      headers,\n      signal: this.abort.signal,\n    };\n  }\n\n  /**\n   * Constructs a new Urbit connection.\n   *\n   * @param url  The URL (with protocol and port) of the ship to be accessed. If\n   * the airlock is running in a webpage served by the ship, this should just\n   * be the empty string.\n   * @param code The access code for the ship at that address\n   */\n  constructor(public url: string, public code?: string, public desk?: string) {\n    if (isBrowser) {\n      window.addEventListener('beforeunload', this.delete);\n    }\n    return this;\n  }\n\n  /**\n   * All-in-one hook-me-up.\n   *\n   * Given a ship, url, and code, this returns an airlock connection\n   * that is ready to go. It `|hi`s itself to create the channel,\n   * then opens the channel via EventSource.\n   *\n   */\n  //TODO  rename this to connect() and only do constructor & event source setup.\n  //      that way it can be used with the assumption that you're already\n  //      authenticated.\n  static async authenticate({\n    ship,\n    url,\n    code,\n    verbose = false,\n  }: AuthenticationInterface) {\n    const airlock = new Urbit(\n      url.startsWith('http') ? url : `http://${url}`,\n      code\n    );\n    airlock.verbose = verbose;\n    airlock.ship = ship;\n    await airlock.connect();\n    await airlock.poke({\n      app: 'hood',\n      mark: 'helm-hi',\n      json: 'opening airlock',\n    });\n    await airlock.eventSource();\n    return airlock;\n  }\n\n  private emit<T extends UrbitHttpApiEventType>(\n    event: T,\n    data: UrbitHttpApiEvent[T]\n  ) {\n    if (this.verbose) {\n      this.emitter.emit(event, data);\n    }\n  }\n\n  on<T extends UrbitHttpApiEventType>(\n    event: T,\n    callback: (data: UrbitHttpApiEvent[T]) => void\n  ): void {\n    this.emitter.on(event, callback);\n\n    this.verbose && console.log(event, 'listening active');\n    if (event === 'init') {\n      this.emitter.emit(event, {\n        uid: this.uid,\n        subscriptions: [...this.outstandingSubscriptions.entries()].map(\n          ([k, v]) => ({ id: k, app: v.app, path: v.path })\n        ),\n      });\n    }\n  }\n\n  /**\n   * Gets the name of the ship accessible at this.url and stores it to this.ship\n   *\n   */\n  async getShipName(): Promise<void> {\n    if (this.ship) {\n      return Promise.resolve();\n    }\n\n    const nameResp = await fetch(`${this.url}/~/host`, {\n      method: 'get',\n      credentials: 'include',\n    });\n    const name = await nameResp.text();\n    this.ship = name.substring(1);\n  }\n\n  /**\n   * Gets the name of the ship accessible at this.url and stores it to this.ship\n   *\n   */\n  async getOurName(): Promise<void> {\n    if (this.our) {\n      return Promise.resolve();\n    }\n\n    const nameResp = await fetch(`${this.url}/~/name`, {\n      method: 'get',\n      credentials: 'include',\n    });\n    const name = await nameResp.text();\n    this.our = name.substring(1);\n  }\n\n  /**\n   * Connects to the Urbit ship. Nothing can be done until this is called.\n   * That's why we roll it into this.authenticate\n   * TODO  as of urbit/urbit#6561, this is no longer true, and we are able\n   *       to interact with the ship using a guest identity.\n   */\n  //TODO  rename to authenticate() and call connect() at the end\n  async connect(): Promise<void> {\n    if (this.verbose) {\n      console.log(\n        `password=${this.code} `,\n        isBrowser\n          ? 'Connecting in browser context at ' + `${this.url}/~/login`\n          : 'Connecting from node context'\n      );\n    }\n    return fetch(`${this.url}/~/login`, {\n      method: 'post',\n      body: `password=${this.code}`,\n      credentials: 'include',\n    }).then(async response => {\n      if (this.verbose) {\n        console.log('Received authentication response', response);\n      }\n      if (response.status >= 200 && response.status < 300) {\n        throw new Error('Login failed with status ' + response.status);\n      }\n      const cookie = response.headers.get('set-cookie');\n      if (!this.ship && cookie) {\n        this.ship = new RegExp(/urbauth-~([\\w-]+)/).exec(cookie)[1];\n      }\n      if (!isBrowser) {\n        this.cookie = cookie;\n      }\n      this.getShipName();\n      this.getOurName();\n    });\n  }\n\n  /**\n   * Initializes the SSE pipe for the appropriate channel.\n   */\n  async eventSource(): Promise<void> {\n    if (this.sseClientInitialized) {\n      return Promise.resolve();\n    }\n    if (this.lastEventId === 0) {\n      this.emit('status-update', { status: 'opening' });\n      // Can't receive events until the channel is open,\n      // so poke and open then\n      await this.poke({\n        app: 'hood',\n        mark: 'helm-hi',\n        json: 'Opening API channel',\n      });\n      return;\n    }\n    this.sseClientInitialized = true;\n    return new Promise((resolve, reject) => {\n      const sseOptions: SSEOptions = {\n        headers: {},\n      };\n      if (isBrowser) {\n        sseOptions.withCredentials = true;\n      } else if (isNode) {\n        sseOptions.headers.Cookie = this.cookie;\n      }\n      fetchEventSource(this.channelUrl, {\n        ...this.fetchOptions,\n        openWhenHidden: true,\n        responseTimeout: 25000,\n        onopen: async (response, isReconnect) => {\n          if (this.verbose) {\n            console.log('Opened eventsource', response);\n          }\n          if (isReconnect) {\n            this.onReconnect && this.onReconnect();\n          }\n          if (response.ok) {\n            this.errorCount = 0;\n            this.onOpen && this.onOpen();\n            this.emit('status-update', {\n              status: isReconnect ? 'reconnected' : 'active',\n            });\n            resolve();\n            return; // everything's good\n          } else {\n            const err = new Error('failed to open eventsource');\n            reject(err);\n          }\n        },\n        onmessage: (event: EventSourceMessage) => {\n          if (this.verbose) {\n            console.log('Received SSE: ', event);\n          }\n          if (!event.id) return;\n          const eventId = parseInt(event.id, 10);\n          this.emit('fact', {\n            id: eventId,\n            data: event.data,\n            time: Date.now(),\n          });\n          if (eventId <= this.lastHeardEventId) {\n            if (this.verbose) {\n              console.log('dropping old or out-of-order event', {\n                eventId,\n                lastHeard: this.lastHeardEventId,\n              });\n            }\n            return;\n          }\n          this.lastHeardEventId = eventId;\n          this.emit('id-update', { lastHeard: this.lastHeardEventId });\n          if (eventId - this.lastAcknowledgedEventId > 20) {\n            this.ack(eventId);\n          }\n\n          if (event.data && JSON.parse(event.data)) {\n            const data: any = JSON.parse(event.data);\n\n            if (\n              data.response === 'poke' &&\n              this.outstandingPokes.has(data.id)\n            ) {\n              const funcs = this.outstandingPokes.get(data.id);\n              if (data.hasOwnProperty('ok')) {\n                funcs.onSuccess();\n              } else if (data.hasOwnProperty('err')) {\n                console.error(data.err);\n                funcs.onError(data.err);\n              } else {\n                console.error('Invalid poke response', data);\n              }\n              this.outstandingPokes.delete(data.id);\n            } else if (\n              data.response === 'subscribe' &&\n              this.outstandingSubscriptions.has(data.id)\n            ) {\n              const funcs = this.outstandingSubscriptions.get(data.id);\n              if (data.hasOwnProperty('err')) {\n                console.error(data.err);\n                funcs.err(data.err, data.id);\n                this.outstandingSubscriptions.delete(data.id);\n              }\n            } else if (\n              data.response === 'diff' &&\n              this.outstandingSubscriptions.has(data.id)\n            ) {\n              const funcs = this.outstandingSubscriptions.get(data.id);\n              try {\n                funcs.event(data.json, data.mark ?? 'json', data.id);\n              } catch (e) {\n                console.error('Failed to call subscription event callback', e);\n              }\n            } else if (\n              data.response === 'quit' &&\n              this.outstandingSubscriptions.has(data.id)\n            ) {\n              const funcs = this.outstandingSubscriptions.get(data.id);\n              funcs.quit(data);\n              this.outstandingSubscriptions.delete(data.id);\n              this.emit('subscription', {\n                id: data.id,\n                status: 'close',\n              });\n            } else if (this.verbose) {\n              console.log([...this.outstandingSubscriptions.keys()]);\n              console.log('Unrecognized response', data);\n            }\n          }\n        },\n        onerror: (error) => {\n          this.errorCount++;\n          this.emit('error', { time: Date.now(), msg: JSON.stringify(error) });\n          if (error instanceof ReapError) {\n            this.seamlessReset();\n            return;\n          }\n          if (!(error instanceof FatalError)) {\n            this.emit('status-update', { status: 'reconnecting' });\n            this.onRetry && this.onRetry();\n            return Math.min(5000, Math.pow(2, this.errorCount - 1) * 750);\n          }\n          this.emit('status-update', { status: 'errored' });\n          this.onError && this.onError(error);\n          throw error;\n        },\n        onclose: () => {\n          console.log('e');\n          throw new Error('Ship unexpectedly closed the connection');\n        },\n      });\n    });\n  }\n\n  /**\n   * Reset airlock, abandoning current subscriptions and wiping state\n   *\n   */\n  reset() {\n    if (this.verbose) {\n      console.log('resetting');\n    }\n    this.delete();\n    this.abort.abort();\n    this.abort = new AbortController();\n    this.uid = `${Math.floor(Date.now() / 1000)}-${hexString(6)}`;\n    this.emit('reset', { uid: this.uid });\n    this.lastEventId = 0;\n    this.lastHeardEventId = -1;\n    this.lastAcknowledgedEventId = -1;\n    this.outstandingSubscriptions = new Map();\n    this.outstandingPokes = new Map();\n    this.sseClientInitialized = false;\n  }\n\n  private seamlessReset() {\n    // called if a channel was reaped by %eyre before we reconnected\n    // so we have to make a new channel.\n    this.uid = `${Math.floor(Date.now() / 1000)}-${hexString(6)}`;\n    this.emit('seamless-reset', { uid: this.uid });\n    this.emit('status-update', { status: 'initial' });\n    this.sseClientInitialized = false;\n    this.lastEventId = 0;\n    this.lastHeardEventId = -1;\n    this.lastAcknowledgedEventId = -1;\n    const oldSubs = [...this.outstandingSubscriptions.entries()];\n    this.outstandingSubscriptions = new Map();\n    oldSubs.forEach(([id, sub]) => {\n      sub.quit({\n        id,\n        response: 'quit',\n      });\n      this.emit('subscription', {\n        id,\n        status: 'close',\n      });\n    });\n\n    this.outstandingPokes.forEach((poke, id) => {\n      poke.onError('Channel was reaped');\n    });\n    this.outstandingPokes = new Map();\n  }\n\n  /**\n   * Autoincrements the next event ID for the appropriate channel.\n   */\n  private getEventId(): number {\n    this.lastEventId += 1;\n    this.emit('id-update', { current: this.lastEventId });\n    return this.lastEventId;\n  }\n\n  /**\n   * Acknowledges an event.\n   *\n   * @param eventId The event to acknowledge.\n   */\n  private async ack(eventId: number): Promise<number | void> {\n    this.lastAcknowledgedEventId = eventId;\n    this.emit('id-update', { lastAcknowledged: eventId });\n    const message: Message = {\n      action: 'ack',\n      'event-id': eventId,\n    };\n    await this.sendJSONtoChannel(message);\n    return eventId;\n  }\n\n  private async sendJSONtoChannel(...json: Message[]): Promise<void> {\n    const response = await fetch(this.channelUrl, {\n      ...this.fetchOptions,\n      method: 'PUT',\n      body: JSON.stringify(json),\n    });\n    if (!response.ok) {\n      throw new Error('Failed to PUT channel');\n    }\n    if (!this.sseClientInitialized) {\n      if (this.verbose) {\n        console.log('initializing event source');\n      }\n      await this.eventSource();\n    }\n  }\n\n  /**\n   * Creates a subscription, waits for a fact and then unsubscribes\n   *\n   * @param app Name of gall agent to subscribe to\n   * @param path Path to subscribe to\n   * @param timeout Optional timeout before ending subscription\n   *\n   * @returns The first fact on the subcription\n   */\n  async subscribeOnce<T = any>(app: string, path: string, timeout?: number) {\n    return new Promise<T>(async (resolve, reject) => {\n      let done = false;\n      let id: number | null = null;\n      const quit = () => {\n        if (!done) {\n          reject('quit');\n        }\n      };\n      const event = (e: T, mark: string, id: number) => {\n        if (!done) {\n          resolve(e);\n          this.unsubscribe(id);\n        }\n      };\n      const request = { app, path, event, err: reject, quit };\n\n      id = await this.subscribe(request);\n\n      if (timeout) {\n        setTimeout(() => {\n          if (!done) {\n            done = true;\n            reject('timeout');\n            this.unsubscribe(id);\n          }\n        }, timeout);\n      }\n    });\n  }\n\n  /**\n   * Pokes a ship with data.\n   *\n   * @param app The app to poke\n   * @param mark The mark of the data being sent\n   * @param json The data to send\n   */\n  async poke<T>(params: PokeInterface<T>): Promise<number> {\n    const { app, mark, json, ship, onSuccess, onError } = {\n      onSuccess: () => {},\n      onError: () => {},\n      ship: this.ship,\n      ...params,\n    };\n\n    if (this.lastEventId === 0) {\n      this.emit('status-update', { status: 'opening' });\n    }\n\n    const message: Message = {\n      id: this.getEventId(),\n      action: 'poke',\n      ship,\n      app,\n      mark,\n      json,\n    };\n    this.outstandingPokes.set(message.id, {\n      onSuccess: () => { onSuccess(); },\n      onError: (err) => { onError(err); },\n    });\n    await this.sendJSONtoChannel(message);\n    return message.id;\n  }\n\n  /**\n   * Subscribes to a path on an app on a ship.\n   *\n   *\n   * @param app The app to subsribe to\n   * @param path The path to which to subscribe\n   * @param handlers Handlers to deal with various events of the subscription\n   */\n  async subscribe(params: SubscriptionRequestInterface): Promise<number> {\n    const { app, path, ship, err, event, quit } = {\n      err: () => {},\n      event: () => {},\n      quit: () => {},\n      ship: this.ship,\n      ...params,\n    };\n\n    if (this.lastEventId === 0) {\n      this.emit('status-update', { status: 'opening' });\n    }\n\n    const message: Message = {\n      id: this.getEventId(),\n      action: 'subscribe',\n      ship,\n      app,\n      path,\n    };\n\n    this.outstandingSubscriptions.set(message.id, {\n      app,\n      path,\n      err,\n      event,\n      quit,\n    });\n\n    this.emit('subscription', {\n      id: message.id,\n      app,\n      path,\n      status: 'open',\n    });\n\n    await this.sendJSONtoChannel(message);\n\n    return message.id;\n  }\n\n  /**\n   * Unsubscribes to a given subscription.\n   *\n   * @param subscription\n   */\n  async unsubscribe(subscription: number) {\n    return this.sendJSONtoChannel({\n      id: this.getEventId(),\n      action: 'unsubscribe',\n      subscription,\n    }).then(() => {\n      this.emit('subscription', {\n        id: subscription,\n        status: 'close',\n      });\n      this.outstandingSubscriptions.delete(subscription);\n    });\n  }\n\n  /**\n   * Deletes the connection to a channel.\n   */\n  async delete() {\n    const body = JSON.stringify([\n      {\n        id: this.getEventId(),\n        action: 'delete',\n      },\n    ]);\n    if (isBrowser) {\n      navigator.sendBeacon(this.channelUrl, body);\n    } else {\n      const response = await fetch(this.channelUrl, {\n        ...this.fetchOptions,\n        method: 'POST',\n        body: body,\n      });\n      if (!response.ok) {\n        throw new Error('Failed to DELETE channel in node context');\n      }\n    }\n  }\n\n  /**\n   * Scry into an gall agent at a path\n   *\n   * @typeParam T - Type of the scry result\n   *\n   * @remarks\n   *\n   * Equivalent to\n   * ```hoon\n   * .^(T %gx /(scot %p our)/[app]/(scot %da now)/[path]/json)\n   * ```\n   * The returned cage must have a conversion to JSON for the scry to succeed\n   *\n   * @param params The scry request\n   * @returns The scry result\n   */\n  async scry<T = any>(params: Scry): Promise<T> {\n    const { app, path } = params;\n    const response = await fetch(\n      `${this.url}/~/scry/${app}${path}.json`,\n      this.fetchOptions\n    );\n\n    if (!response.ok) {\n      return Promise.reject(response);\n    }\n\n    return await response.json();\n  }\n\n  /**\n   * Run a thread\n   *\n   *\n   * @param inputMark   The mark of the data being sent\n   * @param outputMark  The mark of the data being returned\n   * @param threadName  The thread to run\n   * @param body        The data to send to the thread\n   * @returns  The return value of the thread\n   */\n  async thread<R, T = any>(params: Thread<T>): Promise<R> {\n    const {\n      inputMark,\n      outputMark,\n      threadName,\n      body,\n      desk = this.desk,\n    } = params;\n    if (!desk) {\n      throw new Error('Must supply desk to run thread from');\n    }\n    const res = await fetch(\n      `${this.url}/spider/${desk}/${inputMark}/${threadName}/${outputMark}.json`,\n      {\n        ...this.fetchOptions,\n        method: 'POST',\n        body: JSON.stringify(body),\n      }\n    );\n\n    return res.json();\n  }\n\n  /**\n   * Utility function to connect to a ship that has its *.arvo.network domain configured.\n   *\n   * @param name Name of the ship e.g. zod\n   * @param code Code to log in\n   */\n  static async onArvoNetwork(ship: string, code: string): Promise<Urbit> {\n    const url = `https://${ship}.arvo.network`;\n    return await Urbit.authenticate({ ship, url, code });\n  }\n}\n\nexport default Urbit;\n"],"names":["isBrowser","isNode"],"mappings":"AAmMM,MAAO,cAAe,SAAQ,KAAK,CAAA;AAAG,CAAA;AAEtC,MAAO,UAAW,SAAQ,KAAK,CAAA;AAAG,CAAA;AAElC,MAAO,SAAU,SAAQ,KAAK,CAAA;AAAG;;;;ACrMvC,MAAM,CAAC,cAAc,CAAC,GAAO,EAAE,YAAY,EAAE;AAC7C,EAAE,KAAK,EAAE,IAAI;AACb,CAAC,CAAC,CAAC;AACH;AACA,IAAI,OAAO,GAAG,OAAO,MAAM,KAAK,UAAU,IAAI,OAAO,MAAM,CAAC,QAAQ,KAAK,QAAQ,GAAG,UAAU,GAAG,EAAE,EAAE,OAAO,OAAO,GAAG,CAAC,EAAE,GAAG,UAAU,GAAG,EAAE,EAAE,OAAO,GAAG,IAAI,OAAO,MAAM,KAAK,UAAU,IAAI,GAAG,CAAC,WAAW,KAAK,MAAM,IAAI,GAAG,KAAK,MAAM,CAAC,SAAS,GAAG,QAAQ,GAAG,OAAO,GAAG,CAAC,EAAE,CAAC;AAC7Q;AACA;AACA;AACA,IAAI,SAAS,GAAG,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,MAAM,CAAC,QAAQ,KAAK,WAAW,CAAC;AACxF;AACA;AACA,IAAI,WAAW,GAAG,CAAC,OAAO,IAAI,KAAK,WAAW,GAAG,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC,MAAM,QAAQ,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,KAAK,4BAA4B,CAAC;AACzK;AACA;AACA,IAAI,MAAM,GAAG,OAAO,OAAO,KAAK,WAAW,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI,IAAI,OAAO,CAAC,QAAQ,CAAC,IAAI,IAAI,IAAI,CAAC;AACzG;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,OAAO,GAAG,SAAS,OAAO,GAAG;AACjC,EAAE,OAAO,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,IAAI,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AACvJ,CAAC,CAAC;AACF;AACA,IAAiB,WAAA,GAAA,GAAA,CAAA,SAAA,GAAG,SAAS,CAAC;AACX,GAAA,CAAA,WAAA,GAAG,YAAY;AAClC,IAAc,QAAA,GAAA,GAAA,CAAA,MAAA,GAAG,MAAM,CAAC;AACxB,GAAA,CAAA,OAAe,GAAG;;ACflB;;;;;AAKG;AACI,eAAe,QAAQ,CAC5B,MAAkC,EAClC,OAAkC,EAClC,eAAwB,EAAA;AAExB,IAAA,MAAM,MAAM,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC;AAClC,IAAA,IAAI,MAAM,GAAyC;AACjD,QAAA,IAAI,EAAE,KAAK;QACX,KAAK,EAAE,IAAI,UAAU,EAAE;KACxB,CAAC;AAEF,IAAA,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;AAC7B,QAAA,MAAM,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC;YAC1B,MAAM,CAAC,IAAI,EAAE;AACb,YAAA,IAAI,OAAO,CAAuC,CAAC,CAAC,EAAE,MAAM,KAAI;AAC9D,gBAAA,UAAU,CACR,MAAM,MAAM,CAAC,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC,EAC7C,eAAe,CAChB,CAAC;AACJ,aAAC,CAAC;AACH,SAAA,CAAC,CAAC;AAEH,QAAA,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACvB,KAAA;AACH,CAAC;AASD;;;;;AAKG;AACG,SAAU,QAAQ,CACtB,MAAuD,EAAA;AAEvD,IAAA,IAAI,MAA8B,CAAC;IACnC,IAAI,QAAgB,CAAC;IACrB,IAAI,WAAmB,CAAC;IACxB,IAAI,sBAAsB,GAAG,KAAK,CAAC;;IAGnC,OAAO,SAAS,OAAO,CAAC,GAAe,EAAA;QACrC,IAAI,MAAM,KAAK,SAAS,EAAE;YACxB,MAAM,GAAG,GAAG,CAAC;YACb,QAAQ,GAAG,CAAC,CAAC;YACb,WAAW,GAAG,CAAC,CAAC,CAAC;AAClB,SAAA;AAAM,aAAA;;AAEL,YAAA,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;AAC9B,SAAA;AAED,QAAA,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC;AAChC,QAAA,IAAI,SAAS,GAAG,CAAC,CAAC;QAClB,OAAO,QAAQ,GAAG,SAAS,EAAE;AAC3B,YAAA,IAAI,sBAAsB,EAAE;AAC1B,gBAAA,IAAI,MAAM,CAAC,QAAQ,CAAC,oCAA2B;AAC7C,oBAAA,SAAS,GAAG,EAAE,QAAQ,CAAC;AACxB,iBAAA;gBAED,sBAAsB,GAAG,KAAK,CAAC;AAChC,aAAA;;AAGD,YAAA,IAAI,OAAO,GAAG,CAAC,CAAC,CAAC;YACjB,OAAO,QAAQ,GAAG,SAAS,IAAI,OAAO,KAAK,CAAC,CAAC,EAAE,EAAE,QAAQ,EAAE;AACzD,gBAAA,QAAQ,MAAM,CAAC,QAAQ,CAAC;AACtB,oBAAA,KAAA,EAAA;AACE,wBAAA,IAAI,WAAW,KAAK,CAAC,CAAC,EAAE;;AAEtB,4BAAA,WAAW,GAAG,QAAQ,GAAG,SAAS,CAAC;AACpC,yBAAA;wBACD,MAAM;;AAER,oBAAA,KAAA,EAAA;wBACE,sBAAsB,GAAG,IAAI,CAAC;AAChC,oBAAA,KAAA,EAAA;wBACE,OAAO,GAAG,QAAQ,CAAC;wBACnB,MAAM;AACT,iBAAA;AACF,aAAA;AAED,YAAA,IAAI,OAAO,KAAK,CAAC,CAAC,EAAE;;;gBAGlB,MAAM;AACP,aAAA;;AAGD,YAAA,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,SAAS,EAAE,OAAO,CAAC,EAAE,WAAW,CAAC,CAAC;AACzD,YAAA,SAAS,GAAG,QAAQ,CAAC;YACrB,WAAW,GAAG,CAAC,CAAC,CAAC;AAClB,SAAA;QAED,IAAI,SAAS,KAAK,SAAS,EAAE;AAC3B,YAAA,MAAM,GAAG,SAAS,CAAC;AACpB,SAAA;aAAM,IAAI,SAAS,KAAK,CAAC,EAAE;;;AAG1B,YAAA,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;YACpC,QAAQ,IAAI,SAAS,CAAC;AACvB,SAAA;AACH,KAAC,CAAC;AACJ,CAAC;AAED;;;;;;AAMG;SACa,WAAW,CACzB,SAA6C,EAC7C,IAA2B,EAC3B,OAAiC,EAAA;AAEjC,IAAA,IAAI,OAAO,GAAG,UAAU,EAAE,CAAC;AAC3B,IAAA,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE,CAAC;;AAGlC,IAAA,OAAO,SAAS,MAAM,CAAC,IAAgB,EAAE,WAAmB,EAAA;AAC1D,QAAA,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;;AAErB,YAAA,SAAS,GAAG,OAAO,CAAC,CAAC;YACrB,OAAO,GAAG,UAAU,EAAE,CAAC;AACxB,SAAA;aAAM,IAAI,WAAW,GAAG,CAAC,EAAE;;;;AAI1B,YAAA,MAAM,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC;YAC5D,MAAM,WAAW,GACf,WAAW,IAAI,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,KAAuB,EAAA,4BAAG,CAAC,GAAG,CAAC,CAAC,CAAC;AACvE,YAAA,MAAM,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC;AAEzD,YAAA,QAAQ,KAAK;AACX,gBAAA,KAAK,MAAM;;;oBAGT,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,IAAI,GAAG,KAAK,GAAG,KAAK,CAAC;oBAClE,MAAM;AACR,gBAAA,KAAK,OAAO;AACV,oBAAA,OAAO,CAAC,KAAK,GAAG,KAAK,CAAC;oBACtB,MAAM;AACR,gBAAA,KAAK,IAAI;oBACP,IAAI,IAAI,OAAO,CAAC,EAAE,GAAG,KAAK,EAAE,CAAC;oBAC7B,MAAM;AACR,gBAAA,KAAK,OAAO;oBACV,MAAM,KAAK,GAAG,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;AAClC,oBAAA,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE;;wBAEjB,OAAO,IAAI,OAAO,CAAC,KAAK,GAAG,KAAK,EAAE,CAAC;AACpC,qBAAA;oBACD,MAAM;AACT,aAAA;AACF,SAAA;AACH,KAAC,CAAC;AACJ,CAAC;AAED,SAAS,MAAM,CAAC,CAAa,EAAE,CAAa,EAAA;AAC1C,IAAA,MAAM,GAAG,GAAG,IAAI,UAAU,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC;AAChD,IAAA,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACX,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;AACrB,IAAA,OAAO,GAAG,CAAC;AACb,CAAC;AAED,SAAS,UAAU,GAAA;;;;;IAKjB,OAAO;AACL,QAAA,IAAI,EAAE,EAAE;AACR,QAAA,KAAK,EAAE,EAAE;AACT,QAAA,EAAE,EAAE,EAAE;AACN,QAAA,KAAK,EAAE,SAAS;KACjB,CAAC;AACJ;;ACzMO,MAAM,sBAAsB,GAAG,mBAAmB,CAAC;AAE1D,MAAM,oBAAoB,GAAG,IAAI,CAAC;AAClC,MAAM,WAAW,GAAG,eAAe,CAAC;AAqDpB,SAAA,gBAAgB,CAC9B,KAAkB,EAClB,EACE,MAAM,EAAE,WAAW,EACnB,OAAO,EAAE,YAAY,EACrB,MAAM,EAAE,WAAW,EACnB,SAAS,EACT,OAAO,EACP,OAAO,EACP,cAAc,EACd,KAAK,EAAE,UAAU,EACjB,eAAe,EACf,GAAG,IAAI,EACc,EAAA;IAEvB,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM,KAAI;;AAE3C,QAAA,MAAM,OAAO,GAAG,EAAE,GAAG,YAAY,EAAE,CAAC;AACpC,QAAA,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;AACnB,YAAA,OAAO,CAAC,MAAM,GAAG,sBAAsB,CAAC;AACzC,SAAA;AAED,QAAA,IAAI,oBAAqC,CAAC;AAC1C,QAAA,SAAS,kBAAkB,GAAA;AACzB,YAAA,oBAAoB,CAAC,KAAK,EAAE,CAAC;AAC7B,YAAA,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;gBACpB,MAAM,EAAE,CAAC;AACV,aAAA;SACF;AAED,QAAA,IAAI,OAAO,QAAQ,KAAK,WAAW,IAAI,CAAC,cAAc,EAAE;AACtD,YAAA,QAAQ,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,kBAAkB,CAAC,CAAC;AACnE,SAAA;QAED,IAAI,aAAa,GAAG,oBAAoB,CAAC;AACzC,QAAA,IAAI,UAAyC,CAAC;AAC9C,QAAA,SAAS,OAAO,GAAA;AACd,YAAA,IAAI,OAAO,QAAQ,KAAK,WAAW,IAAI,CAAC,cAAc,EAAE;AACtD,gBAAA,QAAQ,CAAC,mBAAmB,CAAC,kBAAkB,EAAE,kBAAkB,CAAC,CAAC;AACtE,aAAA;YACD,YAAY,CAAC,UAAU,CAAC,CAAC;YACzB,oBAAoB,CAAC,KAAK,EAAE,CAAC;SAC9B;;AAGD,QAAA,WAAW,EAAE,gBAAgB,CAAC,OAAO,EAAE,MAAK;AAC1C,YAAA,OAAO,EAAE,CAAC;YACV,OAAO,EAAE,CAAC;AACZ,SAAC,CAAC,CAAC;AAEH,QAAA,MAAM,OAAO,GAAG,UAAU,IAAI,KAAK,CAAC;AACpC,QAAA,MAAM,MAAM,GAAG,WAAW,IAAI,aAAa,CAAC;QAC5C,IAAI,WAAW,GAAG,KAAK,CAAC;AACxB,QAAA,eAAe,MAAM,GAAA;AACnB,YAAA,oBAAoB,GAAG,IAAI,eAAe,EAAE,CAAC;YAC7C,IAAI;AACF,gBAAA,MAAM,QAAQ,IAAI,MAAM,OAAO,CAAC,IAAI,CAAC;oBACnC,OAAO,CAAC,KAAK,EAAE;AACb,wBAAA,GAAG,IAAI;wBACP,OAAO;wBACP,MAAM,EAAE,oBAAoB,CAAC,MAAM;qBACpC,CAAC;AACF,oBAAA,IAAI,OAAO,CAAC,CAAC,CAAC,EAAE,MAAM,KAAI;AACxB,wBAAA,UAAU,CACR,MAAM,MAAM,CAAC,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC,EAC1C,eAAe,CAChB,CAAC;AACJ,qBAAC,CAAC;AACH,iBAAA,CAAC,CAAa,CAAC;AAEhB,gBAAA,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;oBAC3B,OAAO,GAAG,IAAI,SAAS,CAAC,gBAAgB,CAAC,CAAC,CAAC;AAC3C,oBAAA,OAAO,EAAE,CAAC;AACV,oBAAA,OAAO,EAAE,CAAC;oBACV,OAAO;AACR,iBAAA;gBAED,IAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,IAAI,QAAQ,CAAC,MAAM,IAAI,GAAG,EAAE;oBACnD,MAAM,IAAI,KAAK,CAAC,CAAA,yBAAA,EAA4B,QAAQ,CAAC,MAAM,CAAE,CAAA,CAAC,CAAC;AAChE,iBAAA;AAED,gBAAA,MAAM,MAAM,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;;AAEpC,gBAAA,IAAI,WAAW,EAAE;oBACf,WAAW,GAAG,KAAK,CAAC;AACrB,iBAAA;AAED,gBAAA,MAAM,QAAQ,CACZ,QAAQ,CAAC,IAAK,EACd,QAAQ,CACN,WAAW,CACT,SAAS,EACT,CAAC,EAAE,KAAI;AACL,oBAAA,IAAI,EAAE,EAAE;;AAEN,wBAAA,OAAO,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC;AAC3B,qBAAA;AAAM,yBAAA;;AAEL,wBAAA,OAAO,OAAO,CAAC,WAAW,CAAC,CAAC;AAC7B,qBAAA;AACH,iBAAC,EACD,CAAC,KAAK,KAAI;oBACR,aAAa,GAAG,KAAK,CAAC;AACxB,iBAAC,CACF,CACF,EACD,eAAe,CAChB,CAAC;gBAEF,OAAO,IAAI,CAAC;AACZ,gBAAA,OAAO,EAAE,CAAC;AACV,gBAAA,OAAO,EAAE,CAAC;AACX,aAAA;AAAC,YAAA,OAAO,GAAG,EAAE;AACZ,gBAAA,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,OAAO,EAAE;;oBAExC,IAAI;wBACF,WAAW,GAAG,IAAI,CAAC;;wBAEnB,MAAM,QAAQ,GAAQ,OAAO,GAAG,GAAG,CAAC,IAAI,aAAa,CAAC;wBACtD,YAAY,CAAC,UAAU,CAAC,CAAC;wBACzB,oBAAoB,CAAC,KAAK,EAAE,CAAC;AAC7B,wBAAA,UAAU,GAAG,UAAU,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;AAC3C,qBAAA;AAAC,oBAAA,OAAO,QAAQ,EAAE;;AAEjB,wBAAA,OAAO,EAAE,CAAC;wBACV,MAAM,CAAC,QAAQ,CAAC,CAAC;AAClB,qBAAA;AACF,iBAAA;AACF,aAAA;SACF;AAED,QAAA,MAAM,EAAE,CAAC;AACX,KAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,aAAa,CAAC,QAAkB,EAAA;IACvC,MAAM,WAAW,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;AACzD,IAAA,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,sBAAsB,CAAC,EAAE;QACpD,MAAM,IAAI,KAAK,CACb,CAAA,4BAAA,EAA+B,sBAAsB,CAAa,UAAA,EAAA,WAAW,CAAE,CAAA,CAChF,CAAC;AACH,KAAA;AACH;;ACtLA;;;;;;AAMG;AACG,SAAU,SAAS,CAAC,GAAW,EAAA;IACnC,MAAM,MAAM,GAAG,CAAC,CAAC;AACjB,IAAA,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;AACpD,IAAA,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC;IACpD,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;IAC5D,IAAI,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;AACvB,IAAA,OAAO,CAAC,CAAC,MAAM,GAAG,GAAG,EAAE;QACrB,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,GAAG,GAAG,MAAM,CAAC,CAAC;AACjC,KAAA;AACD,IAAA,OAAO,CAAC,CAAC;AACX,CAAC;AAkBa,MAAO,YAAY,CAAA;IACvB,SAAS,GAA+B,EAAE,CAAC;IAEnD,EAAE,CAAC,KAAa,EAAE,QAAkB,EAAA;QAClC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;AACzC,YAAA,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;AAC5B,SAAA;QAED,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAErC,QAAA,OAAO,IAAI,CAAC;KACb;AAED,IAAA,IAAI,CAAC,KAAa,EAAE,GAAG,IAAS,EAAA;QAC9B,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;AACzC,YAAA,OAAO,IAAI,CAAC;AACb,SAAA;AAED,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrD,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAE1C,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC;AAC9B,SAAA;KACF;AACF;;AC3DD;;AAEG;MACU,KAAK,CAAA;AAkHG,IAAA,GAAA,CAAA;AAAoB,IAAA,IAAA,CAAA;AAAsB,IAAA,IAAA,CAAA;AAjH7D;;AAEG;AACK,IAAA,OAAO,GAAG,IAAI,YAAY,EAAE,CAAC;AAErC;;AAEG;AACK,IAAA,GAAG,GAAW,CAAG,EAAA,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAI,CAAA,EAAA,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC;AAEzE;;;;AAIG;IACK,WAAW,GAAW,CAAC,CAAC;IACxB,gBAAgB,GAAW,CAAC,CAAC,CAAC;IAC9B,uBAAuB,GAAW,CAAC,CAAC,CAAC;AAE7C;;AAEG;IACK,oBAAoB,GAAY,KAAK,CAAC;AAE9C;;AAEG;AACH,IAAA,MAAM,CAAsB;AAE5B;;;;;;;AAOG;AAEK,IAAA,gBAAgB,GAA8B,IAAI,GAAG,EAAE,CAAC;AAEhE;;;;;;;;AAQG;AACK,IAAA,wBAAwB,GAC9B,IAAI,GAAG,EAAE,CAAC;AAEZ;;AAEG;AACK,IAAA,KAAK,GAAG,IAAI,eAAe,EAAE,CAAC;AAEtC;;AAEG;AACH,IAAA,IAAI,CAAiB;AAErB;;AAEG;AACH,IAAA,GAAG,CAAiB;AAEpB;;AAEG;AACH,IAAA,OAAO,CAAW;AAElB;;AAEG;IACK,UAAU,GAAG,CAAC,CAAC;IAEvB,OAAO,GAA0B,IAAI,CAAC;IAEtC,OAAO,GAAgB,IAAI,CAAC;IAE5B,MAAM,GAAgB,IAAI,CAAC;IAE3B,WAAW,GAAgB,IAAI,CAAC;;AAGhC,IAAA,IAAY,UAAU,GAAA;QACpB,OAAO,CAAA,EAAG,IAAI,CAAC,GAAG,cAAc,IAAI,CAAC,GAAG,CAAA,CAAE,CAAC;KAC5C;AAED,IAAA,IAAY,YAAY,GAAA;AACtB,QAAA,MAAM,OAAO,GAAY;AACvB,YAAA,cAAc,EAAE,kBAAkB;SACnC,CAAC;QACF,IAAI,CAACA,WAAS,EAAE;AACd,YAAA,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AAC9B,SAAA;QACD,OAAO;AACL,YAAA,WAAW,EAAE,SAAS;AACtB,YAAA,MAAM,EAAE,GAAG;YACX,OAAO;AACP,YAAA,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM;SAC1B,CAAC;KACH;AAED;;;;;;;AAOG;AACH,IAAA,WAAA,CAAmB,GAAW,EAAS,IAAa,EAAS,IAAa,EAAA;QAAvD,IAAG,CAAA,GAAA,GAAH,GAAG,CAAQ;QAAS,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAS;QAAS,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAS;AACxE,QAAA,IAAIA,WAAS,EAAE;YACb,MAAM,CAAC,gBAAgB,CAAC,cAAc,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AACtD,SAAA;AACD,QAAA,OAAO,IAAI,CAAC;KACb;AAED;;;;;;;AAOG;;;;AAIH,IAAA,aAAa,YAAY,CAAC,EACxB,IAAI,EACJ,GAAG,EACH,IAAI,EACJ,OAAO,GAAG,KAAK,GACS,EAAA;QACxB,MAAM,OAAO,GAAG,IAAI,KAAK,CACvB,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,CAAA,OAAA,EAAU,GAAG,CAAE,CAAA,EAC9C,IAAI,CACL,CAAC;AACF,QAAA,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC;AAC1B,QAAA,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC;AACpB,QAAA,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;QACxB,MAAM,OAAO,CAAC,IAAI,CAAC;AACjB,YAAA,GAAG,EAAE,MAAM;AACX,YAAA,IAAI,EAAE,SAAS;AACf,YAAA,IAAI,EAAE,iBAAiB;AACxB,SAAA,CAAC,CAAC;AACH,QAAA,MAAM,OAAO,CAAC,WAAW,EAAE,CAAC;AAC5B,QAAA,OAAO,OAAO,CAAC;KAChB;IAEO,IAAI,CACV,KAAQ,EACR,IAA0B,EAAA;QAE1B,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;AAChC,SAAA;KACF;IAED,EAAE,CACA,KAAQ,EACR,QAA8C,EAAA;QAE9C,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAEjC,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,kBAAkB,CAAC,CAAC;QACvD,IAAI,KAAK,KAAK,MAAM,EAAE;AACpB,YAAA,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE;gBACvB,GAAG,EAAE,IAAI,CAAC,GAAG;AACb,gBAAA,aAAa,EAAE,CAAC,GAAG,IAAI,CAAC,wBAAwB,CAAC,OAAO,EAAE,CAAC,CAAC,GAAG,CAC7D,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,EAAE,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC,CAClD;AACF,aAAA,CAAC,CAAC;AACJ,SAAA;KACF;AAED;;;AAGG;AACH,IAAA,MAAM,WAAW,GAAA;QACf,IAAI,IAAI,CAAC,IAAI,EAAE;AACb,YAAA,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;AAC1B,SAAA;QAED,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAA,OAAA,CAAS,EAAE;AACjD,YAAA,MAAM,EAAE,KAAK;AACb,YAAA,WAAW,EAAE,SAAS;AACvB,SAAA,CAAC,CAAC;AACH,QAAA,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;QACnC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;KAC/B;AAED;;;AAGG;AACH,IAAA,MAAM,UAAU,GAAA;QACd,IAAI,IAAI,CAAC,GAAG,EAAE;AACZ,YAAA,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;AAC1B,SAAA;QAED,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAA,OAAA,CAAS,EAAE;AACjD,YAAA,MAAM,EAAE,KAAK;AACb,YAAA,WAAW,EAAE,SAAS;AACvB,SAAA,CAAC,CAAC;AACH,QAAA,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;QACnC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;KAC9B;AAED;;;;;AAKG;;AAEH,IAAA,MAAM,OAAO,GAAA;QACX,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,OAAO,CAAC,GAAG,CACT,CAAA,SAAA,EAAY,IAAI,CAAC,IAAI,CAAG,CAAA,CAAA,EACxBA,WAAS;AACP,kBAAE,mCAAmC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAU,QAAA,CAAA;kBAC3D,8BAA8B,CACnC,CAAC;AACH,SAAA;AACD,QAAA,OAAO,KAAK,CAAC,CAAA,EAAG,IAAI,CAAC,GAAG,UAAU,EAAE;AAClC,YAAA,MAAM,EAAE,MAAM;AACd,YAAA,IAAI,EAAE,CAAA,SAAA,EAAY,IAAI,CAAC,IAAI,CAAE,CAAA;AAC7B,YAAA,WAAW,EAAE,SAAS;AACvB,SAAA,CAAC,CAAC,IAAI,CAAC,OAAM,QAAQ,KAAG;YACvB,IAAI,IAAI,CAAC,OAAO,EAAE;AAChB,gBAAA,OAAO,CAAC,GAAG,CAAC,kCAAkC,EAAE,QAAQ,CAAC,CAAC;AAC3D,aAAA;YACD,IAAI,QAAQ,CAAC,MAAM,IAAI,GAAG,IAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,EAAE;gBACnD,MAAM,IAAI,KAAK,CAAC,2BAA2B,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC;AAChE,aAAA;YACD,MAAM,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;AAClD,YAAA,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,MAAM,EAAE;AACxB,gBAAA,IAAI,CAAC,IAAI,GAAG,IAAI,MAAM,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;AAC7D,aAAA;YACD,IAAI,CAACA,WAAS,EAAE;AACd,gBAAA,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACtB,aAAA;YACD,IAAI,CAAC,WAAW,EAAE,CAAC;YACnB,IAAI,CAAC,UAAU,EAAE,CAAC;AACpB,SAAC,CAAC,CAAC;KACJ;AAED;;AAEG;AACH,IAAA,MAAM,WAAW,GAAA;QACf,IAAI,IAAI,CAAC,oBAAoB,EAAE;AAC7B,YAAA,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;AAC1B,SAAA;AACD,QAAA,IAAI,IAAI,CAAC,WAAW,KAAK,CAAC,EAAE;YAC1B,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;;;YAGlD,MAAM,IAAI,CAAC,IAAI,CAAC;AACd,gBAAA,GAAG,EAAE,MAAM;AACX,gBAAA,IAAI,EAAE,SAAS;AACf,gBAAA,IAAI,EAAE,qBAAqB;AAC5B,aAAA,CAAC,CAAC;YACH,OAAO;AACR,SAAA;AACD,QAAA,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;QACjC,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAI;AAIrC,YAAA,IAAIA,WAAS,EAAE,CAEd;AAAM,iBAAA,IAAIC,QAAM,EAAE;gBACW,IAAI,CAAC,MAAM,CAAC;AACzC,aAAA;AACD,YAAA,gBAAgB,CAAC,IAAI,CAAC,UAAU,EAAE;gBAChC,GAAG,IAAI,CAAC,YAAY;AACpB,gBAAA,cAAc,EAAE,IAAI;AACpB,gBAAA,eAAe,EAAE,KAAK;AACtB,gBAAA,MAAM,EAAE,OAAO,QAAQ,EAAE,WAAW,KAAI;oBACtC,IAAI,IAAI,CAAC,OAAO,EAAE;AAChB,wBAAA,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,QAAQ,CAAC,CAAC;AAC7C,qBAAA;AACD,oBAAA,IAAI,WAAW,EAAE;AACf,wBAAA,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;AACxC,qBAAA;oBACD,IAAI,QAAQ,CAAC,EAAE,EAAE;AACf,wBAAA,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;AACpB,wBAAA,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;AAC7B,wBAAA,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE;4BACzB,MAAM,EAAE,WAAW,GAAG,aAAa,GAAG,QAAQ;AAC/C,yBAAA,CAAC,CAAC;AACH,wBAAA,OAAO,EAAE,CAAC;AACV,wBAAA,OAAO;AACR,qBAAA;AAAM,yBAAA;AACL,wBAAA,MAAM,GAAG,GAAG,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;wBACpD,MAAM,CAAC,GAAG,CAAC,CAAC;AACb,qBAAA;iBACF;AACD,gBAAA,SAAS,EAAE,CAAC,KAAyB,KAAI;oBACvC,IAAI,IAAI,CAAC,OAAO,EAAE;AAChB,wBAAA,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;AACtC,qBAAA;oBACD,IAAI,CAAC,KAAK,CAAC,EAAE;wBAAE,OAAO;oBACtB,MAAM,OAAO,GAAG,QAAQ,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;AACvC,oBAAA,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAChB,wBAAA,EAAE,EAAE,OAAO;wBACX,IAAI,EAAE,KAAK,CAAC,IAAI;AAChB,wBAAA,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE;AACjB,qBAAA,CAAC,CAAC;AACH,oBAAA,IAAI,OAAO,IAAI,IAAI,CAAC,gBAAgB,EAAE;wBACpC,IAAI,IAAI,CAAC,OAAO,EAAE;AAChB,4BAAA,OAAO,CAAC,GAAG,CAAC,oCAAoC,EAAE;gCAChD,OAAO;gCACP,SAAS,EAAE,IAAI,CAAC,gBAAgB;AACjC,6BAAA,CAAC,CAAC;AACJ,yBAAA;wBACD,OAAO;AACR,qBAAA;AACD,oBAAA,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC;AAChC,oBAAA,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,SAAS,EAAE,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC;AAC7D,oBAAA,IAAI,OAAO,GAAG,IAAI,CAAC,uBAAuB,GAAG,EAAE,EAAE;AAC/C,wBAAA,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AACnB,qBAAA;AAED,oBAAA,IAAI,KAAK,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;wBACxC,MAAM,IAAI,GAAQ,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AAEzC,wBAAA,IACE,IAAI,CAAC,QAAQ,KAAK,MAAM;4BACxB,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,EAClC;AACA,4BAAA,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACjD,4BAAA,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;gCAC7B,KAAK,CAAC,SAAS,EAAE,CAAC;AACnB,6BAAA;AAAM,iCAAA,IAAI,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;AACrC,gCAAA,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACxB,gCAAA,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACzB,6BAAA;AAAM,iCAAA;AACL,gCAAA,OAAO,CAAC,KAAK,CAAC,uBAAuB,EAAE,IAAI,CAAC,CAAC;AAC9C,6BAAA;4BACD,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACvC,yBAAA;AAAM,6BAAA,IACL,IAAI,CAAC,QAAQ,KAAK,WAAW;4BAC7B,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,EAC1C;AACA,4BAAA,MAAM,KAAK,GAAG,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACzD,4BAAA,IAAI,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;AAC9B,gCAAA,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gCACxB,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;gCAC7B,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAC/C,6BAAA;AACF,yBAAA;AAAM,6BAAA,IACL,IAAI,CAAC,QAAQ,KAAK,MAAM;4BACxB,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,EAC1C;AACA,4BAAA,MAAM,KAAK,GAAG,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;4BACzD,IAAI;AACF,gCAAA,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,IAAI,MAAM,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;AACtD,6BAAA;AAAC,4BAAA,OAAO,CAAC,EAAE;AACV,gCAAA,OAAO,CAAC,KAAK,CAAC,4CAA4C,EAAE,CAAC,CAAC,CAAC;AAChE,6BAAA;AACF,yBAAA;AAAM,6BAAA,IACL,IAAI,CAAC,QAAQ,KAAK,MAAM;4BACxB,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,EAC1C;AACA,4BAAA,MAAM,KAAK,GAAG,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACzD,4BAAA,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;4BACjB,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAC9C,4BAAA,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gCACxB,EAAE,EAAE,IAAI,CAAC,EAAE;AACX,gCAAA,MAAM,EAAE,OAAO;AAChB,6BAAA,CAAC,CAAC;AACJ,yBAAA;6BAAM,IAAI,IAAI,CAAC,OAAO,EAAE;AACvB,4BAAA,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,wBAAwB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;AACvD,4BAAA,OAAO,CAAC,GAAG,CAAC,uBAAuB,EAAE,IAAI,CAAC,CAAC;AAC5C,yBAAA;AACF,qBAAA;iBACF;AACD,gBAAA,OAAO,EAAE,CAAC,KAAK,KAAI;oBACjB,IAAI,CAAC,UAAU,EAAE,CAAC;oBAClB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;oBACrE,IAAI,KAAK,YAAY,SAAS,EAAE;wBAC9B,IAAI,CAAC,aAAa,EAAE,CAAC;wBACrB,OAAO;AACR,qBAAA;AACD,oBAAA,IAAI,EAAE,KAAK,YAAY,UAAU,CAAC,EAAE;wBAClC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,cAAc,EAAE,CAAC,CAAC;AACvD,wBAAA,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;wBAC/B,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;AAC/D,qBAAA;oBACD,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;oBAClD,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AACpC,oBAAA,MAAM,KAAK,CAAC;iBACb;gBACD,OAAO,EAAE,MAAK;AACZ,oBAAA,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AACjB,oBAAA,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;iBAC5D;AACF,aAAA,CAAC,CAAC;AACL,SAAC,CAAC,CAAC;KACJ;AAED;;;AAGG;IACH,KAAK,GAAA;QACH,IAAI,IAAI,CAAC,OAAO,EAAE;AAChB,YAAA,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;AAC1B,SAAA;QACD,IAAI,CAAC,MAAM,EAAE,CAAC;AACd,QAAA,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;AACnB,QAAA,IAAI,CAAC,KAAK,GAAG,IAAI,eAAe,EAAE,CAAC;QACnC,IAAI,CAAC,GAAG,GAAG,CAAA,EAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAA,CAAA,EAAI,SAAS,CAAC,CAAC,CAAC,CAAA,CAAE,CAAC;AAC9D,QAAA,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;AACtC,QAAA,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;AACrB,QAAA,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC;AAC3B,QAAA,IAAI,CAAC,uBAAuB,GAAG,CAAC,CAAC,CAAC;AAClC,QAAA,IAAI,CAAC,wBAAwB,GAAG,IAAI,GAAG,EAAE,CAAC;AAC1C,QAAA,IAAI,CAAC,gBAAgB,GAAG,IAAI,GAAG,EAAE,CAAC;AAClC,QAAA,IAAI,CAAC,oBAAoB,GAAG,KAAK,CAAC;KACnC;IAEO,aAAa,GAAA;;;QAGnB,IAAI,CAAC,GAAG,GAAG,CAAA,EAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAA,CAAA,EAAI,SAAS,CAAC,CAAC,CAAC,CAAA,CAAE,CAAC;AAC9D,QAAA,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;QAC/C,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;AAClD,QAAA,IAAI,CAAC,oBAAoB,GAAG,KAAK,CAAC;AAClC,QAAA,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC;AACrB,QAAA,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,CAAC;AAC3B,QAAA,IAAI,CAAC,uBAAuB,GAAG,CAAC,CAAC,CAAC;QAClC,MAAM,OAAO,GAAG,CAAC,GAAG,IAAI,CAAC,wBAAwB,CAAC,OAAO,EAAE,CAAC,CAAC;AAC7D,QAAA,IAAI,CAAC,wBAAwB,GAAG,IAAI,GAAG,EAAE,CAAC;QAC1C,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,KAAI;YAC5B,GAAG,CAAC,IAAI,CAAC;gBACP,EAAE;AACF,gBAAA,QAAQ,EAAE,MAAM;AACjB,aAAA,CAAC,CAAC;AACH,YAAA,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gBACxB,EAAE;AACF,gBAAA,MAAM,EAAE,OAAO;AAChB,aAAA,CAAC,CAAC;AACL,SAAC,CAAC,CAAC;QAEH,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,KAAI;AACzC,YAAA,IAAI,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC;AACrC,SAAC,CAAC,CAAC;AACH,QAAA,IAAI,CAAC,gBAAgB,GAAG,IAAI,GAAG,EAAE,CAAC;KACnC;AAED;;AAEG;IACK,UAAU,GAAA;AAChB,QAAA,IAAI,CAAC,WAAW,IAAI,CAAC,CAAC;AACtB,QAAA,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;QACtD,OAAO,IAAI,CAAC,WAAW,CAAC;KACzB;AAED;;;;AAIG;IACK,MAAM,GAAG,CAAC,OAAe,EAAA;AAC/B,QAAA,IAAI,CAAC,uBAAuB,GAAG,OAAO,CAAC;QACvC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,gBAAgB,EAAE,OAAO,EAAE,CAAC,CAAC;AACtD,QAAA,MAAM,OAAO,GAAY;AACvB,YAAA,MAAM,EAAE,KAAK;AACb,YAAA,UAAU,EAAE,OAAO;SACpB,CAAC;AACF,QAAA,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;AACtC,QAAA,OAAO,OAAO,CAAC;KAChB;AAEO,IAAA,MAAM,iBAAiB,CAAC,GAAG,IAAe,EAAA;QAChD,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,IAAI,CAAC,UAAU,EAAE;YAC5C,GAAG,IAAI,CAAC,YAAY;AACpB,YAAA,MAAM,EAAE,KAAK;AACb,YAAA,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;AAC3B,SAAA,CAAC,CAAC;AACH,QAAA,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AAChB,YAAA,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;AAC1C,SAAA;AACD,QAAA,IAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE;YAC9B,IAAI,IAAI,CAAC,OAAO,EAAE;AAChB,gBAAA,OAAO,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;AAC1C,aAAA;AACD,YAAA,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC;AAC1B,SAAA;KACF;AAED;;;;;;;;AAQG;AACH,IAAA,MAAM,aAAa,CAAU,GAAW,EAAE,IAAY,EAAE,OAAgB,EAAA;QACtE,OAAO,IAAI,OAAO,CAAI,OAAO,OAAO,EAAE,MAAM,KAAI;YAC9C,IAAI,IAAI,GAAG,KAAK,CAAC;YACjB,IAAI,EAAE,GAAkB,IAAI,CAAC;YAC7B,MAAM,IAAI,GAAG,MAAK;gBAChB,IAAI,CAAC,IAAI,EAAE;oBACT,MAAM,CAAC,MAAM,CAAC,CAAC;AAChB,iBAAA;AACH,aAAC,CAAC;YACF,MAAM,KAAK,GAAG,CAAC,CAAI,EAAE,IAAY,EAAE,EAAU,KAAI;gBAC/C,IAAI,CAAC,IAAI,EAAE;oBACT,OAAO,CAAC,CAAC,CAAC,CAAC;AACX,oBAAA,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;AACtB,iBAAA;AACH,aAAC,CAAC;AACF,YAAA,MAAM,OAAO,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;YAExD,EAAE,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AAEnC,YAAA,IAAI,OAAO,EAAE;gBACX,UAAU,CAAC,MAAK;oBACd,IAAI,CAAC,IAAI,EAAE;wBACT,IAAI,GAAG,IAAI,CAAC;wBACZ,MAAM,CAAC,SAAS,CAAC,CAAC;AAClB,wBAAA,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;AACtB,qBAAA;iBACF,EAAE,OAAO,CAAC,CAAC;AACb,aAAA;AACH,SAAC,CAAC,CAAC;KACJ;AAED;;;;;;AAMG;IACH,MAAM,IAAI,CAAI,MAAwB,EAAA;AACpC,QAAA,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG;AACpD,YAAA,SAAS,EAAE,MAAK,GAAG;AACnB,YAAA,OAAO,EAAE,MAAK,GAAG;YACjB,IAAI,EAAE,IAAI,CAAC,IAAI;AACf,YAAA,GAAG,MAAM;SACV,CAAC;AAEF,QAAA,IAAI,IAAI,CAAC,WAAW,KAAK,CAAC,EAAE;YAC1B,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;AACnD,SAAA;AAED,QAAA,MAAM,OAAO,GAAY;AACvB,YAAA,EAAE,EAAE,IAAI,CAAC,UAAU,EAAE;AACrB,YAAA,MAAM,EAAE,MAAM;YACd,IAAI;YACJ,GAAG;YACH,IAAI;YACJ,IAAI;SACL,CAAC;QACF,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,EAAE;YACpC,SAAS,EAAE,MAAK,EAAG,SAAS,EAAE,CAAC,EAAE;AACjC,YAAA,OAAO,EAAE,CAAC,GAAG,KAAI,EAAG,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE;AACpC,SAAA,CAAC,CAAC;AACH,QAAA,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;QACtC,OAAO,OAAO,CAAC,EAAE,CAAC;KACnB;AAED;;;;;;;AAOG;IACH,MAAM,SAAS,CAAC,MAAoC,EAAA;AAClD,QAAA,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG;AAC5C,YAAA,GAAG,EAAE,MAAK,GAAG;AACb,YAAA,KAAK,EAAE,MAAK,GAAG;AACf,YAAA,IAAI,EAAE,MAAK,GAAG;YACd,IAAI,EAAE,IAAI,CAAC,IAAI;AACf,YAAA,GAAG,MAAM;SACV,CAAC;AAEF,QAAA,IAAI,IAAI,CAAC,WAAW,KAAK,CAAC,EAAE;YAC1B,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,CAAC;AACnD,SAAA;AAED,QAAA,MAAM,OAAO,GAAY;AACvB,YAAA,EAAE,EAAE,IAAI,CAAC,UAAU,EAAE;AACrB,YAAA,MAAM,EAAE,WAAW;YACnB,IAAI;YACJ,GAAG;YACH,IAAI;SACL,CAAC;QAEF,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,EAAE;YAC5C,GAAG;YACH,IAAI;YACJ,GAAG;YACH,KAAK;YACL,IAAI;AACL,SAAA,CAAC,CAAC;AAEH,QAAA,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;YACxB,EAAE,EAAE,OAAO,CAAC,EAAE;YACd,GAAG;YACH,IAAI;AACJ,YAAA,MAAM,EAAE,MAAM;AACf,SAAA,CAAC,CAAC;AAEH,QAAA,MAAM,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;QAEtC,OAAO,OAAO,CAAC,EAAE,CAAC;KACnB;AAED;;;;AAIG;IACH,MAAM,WAAW,CAAC,YAAoB,EAAA;QACpC,OAAO,IAAI,CAAC,iBAAiB,CAAC;AAC5B,YAAA,EAAE,EAAE,IAAI,CAAC,UAAU,EAAE;AACrB,YAAA,MAAM,EAAE,aAAa;YACrB,YAAY;AACb,SAAA,CAAC,CAAC,IAAI,CAAC,MAAK;AACX,YAAA,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;AACxB,gBAAA,EAAE,EAAE,YAAY;AAChB,gBAAA,MAAM,EAAE,OAAO;AAChB,aAAA,CAAC,CAAC;AACH,YAAA,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AACrD,SAAC,CAAC,CAAC;KACJ;AAED;;AAEG;AACH,IAAA,MAAM,MAAM,GAAA;AACV,QAAA,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC;AAC1B,YAAA;AACE,gBAAA,EAAE,EAAE,IAAI,CAAC,UAAU,EAAE;AACrB,gBAAA,MAAM,EAAE,QAAQ;AACjB,aAAA;AACF,SAAA,CAAC,CAAC;AACH,QAAA,IAAID,WAAS,EAAE;YACb,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;AAC7C,SAAA;AAAM,aAAA;YACL,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,IAAI,CAAC,UAAU,EAAE;gBAC5C,GAAG,IAAI,CAAC,YAAY;AACpB,gBAAA,MAAM,EAAE,MAAM;AACd,gBAAA,IAAI,EAAE,IAAI;AACX,aAAA,CAAC,CAAC;AACH,YAAA,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AAChB,gBAAA,MAAM,IAAI,KAAK,CAAC,0CAA0C,CAAC,CAAC;AAC7D,aAAA;AACF,SAAA;KACF;AAED;;;;;;;;;;;;;;;AAeG;IACH,MAAM,IAAI,CAAU,MAAY,EAAA;AAC9B,QAAA,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,MAAM,CAAC;AAC7B,QAAA,MAAM,QAAQ,GAAG,MAAM,KAAK,CAC1B,CAAA,EAAG,IAAI,CAAC,GAAG,WAAW,GAAG,CAAA,EAAG,IAAI,CAAO,KAAA,CAAA,EACvC,IAAI,CAAC,YAAY,CAClB,CAAC;AAEF,QAAA,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AAChB,YAAA,OAAO,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;AACjC,SAAA;AAED,QAAA,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;KAC9B;AAED;;;;;;;;;AASG;IACH,MAAM,MAAM,CAAa,MAAiB,EAAA;AACxC,QAAA,MAAM,EACJ,SAAS,EACT,UAAU,EACV,UAAU,EACV,IAAI,EACJ,IAAI,GAAG,IAAI,CAAC,IAAI,GACjB,GAAG,MAAM,CAAC;QACX,IAAI,CAAC,IAAI,EAAE;AACT,YAAA,MAAM,IAAI,KAAK,CAAC,qCAAqC,CAAC,CAAC;AACxD,SAAA;AACD,QAAA,MAAM,GAAG,GAAG,MAAM,KAAK,CACrB,CAAA,EAAG,IAAI,CAAC,GAAG,CAAW,QAAA,EAAA,IAAI,IAAI,SAAS,CAAA,CAAA,EAAI,UAAU,CAAI,CAAA,EAAA,UAAU,OAAO,EAC1E;YACE,GAAG,IAAI,CAAC,YAAY;AACpB,YAAA,MAAM,EAAE,MAAM;AACd,YAAA,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;AAC3B,SAAA,CACF,CAAC;AAEF,QAAA,OAAO,GAAG,CAAC,IAAI,EAAE,CAAC;KACnB;AAED;;;;;AAKG;AACH,IAAA,aAAa,aAAa,CAAC,IAAY,EAAE,IAAY,EAAA;AACnD,QAAA,MAAM,GAAG,GAAG,CAAW,QAAA,EAAA,IAAI,eAAe,CAAC;AAC3C,QAAA,OAAO,MAAM,KAAK,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC;KACtD;AACF;;;;"}