import * as db from '../db';
import * as ub from '../urbit';
export declare function getGroupAndChannelUnreads(): Promise<db.ActivityInit>;
export declare function getThreadUnreadsByChannel(channel: db.Channel): Promise<db.ThreadUnreadState[]>;
export declare function getVolumeSettings(): Promise<ub.VolumeSettings>;
export declare const ACTIVITY_SOURCE_PAGESIZE = 30;
export declare function getInitialActivity(): Promise<{
    events: db.ActivityEvent[];
    relevantUnreads: db.ActivityInit;
}>;
export declare function fromInitFeedToBucketedActivityEvents(feeds: Omit<ub.InitActivityFeeds, 'summaries'>): db.ActivityEvent[];
export declare function getPagedActivityByBucket({ cursor, bucket, }: {
    cursor: number;
    bucket: db.ActivityBucket;
}): Promise<{
    events: db.ActivityEvent[];
    nextCursor: number | null;
    relevantUnreads: db.ActivityInit;
}>;
export declare function fromFeedToActivityEvents(feed: ub.ActivityBundle[], bucket: db.ActivityBucket): db.ActivityEvent[];
export type EnhancedStream = Record<string, ub.ActivityEvent & {
    sourceId: string;
}>;
export declare function parseContactUpdateEvent(eventId: string, event: ub.ContactEvent): Partial<db.ActivityEvent> | null;
export type ActivityEvent = {
    type: 'updateBaseUnread';
    unread: db.BaseUnread;
} | {
    type: 'updateChannelUnread';
    activity: db.ChannelUnread;
} | {
    type: 'updateThreadUnread';
    activity: db.ThreadUnreadState;
} | {
    type: 'updateGroupUnread';
    unread: db.GroupUnread;
} | {
    type: 'updateItemVolume';
    volumeUpdate: db.VolumeSettings;
} | {
    type: 'removeItemVolume';
    itemId: string;
    itemType: string;
} | {
    type: 'updatePushNotificationsSetting';
    value: ub.PushNotificationsSetting;
} | {
    type: 'addActivityEvent';
    events: db.ActivityEvent[];
};
export declare function subscribeToActivity(handler: (event: ActivityEvent) => void): void;
export declare function activityAction(action: ub.ActivityAction): {
    app: string;
    mark: string;
    json: ub.ActivityAction;
};
export declare const readAll: () => Promise<number>;
export declare const readGroup: (group: db.Group, deep?: boolean) => Promise<number>;
export declare const readChannel: ({ channelId, channelType, groupId, deep, }: {
    channelId: string;
    channelType: db.ChannelType;
    groupId?: string | null;
    deep?: boolean;
}) => Promise<number>;
export declare const readThread: ({ parentPost, channel, }: {
    post: db.Post;
    parentPost: db.Post;
    channel: db.Channel;
}) => Promise<number>;
export declare function markInvitesRead(): Promise<number>;
export declare function getMessageKey(channel: db.Channel, post: db.Post): {
    id: string;
    time: string;
};
interface ClientBaseSource {
    type: 'base';
}
interface ClientGroupSource {
    type: 'group';
    groupId: string;
}
interface ClientChannelSource {
    type: 'channel';
    channelId: string;
}
interface ClientThreadSource {
    type: 'thread';
    channelId: string;
    channelType: db.ChannelUnread['type'];
    threadId: string;
}
interface ClientUnknownSource {
    type: 'unknown';
}
interface ClientContactSource {
    type: 'contact';
    contactUserId: string;
}
export type ClientSource = ClientBaseSource | ClientGroupSource | ClientChannelSource | ClientThreadSource | ClientUnknownSource | ClientContactSource;
export declare function sourceIdToSource(sourceId: string): ClientSource;
export declare function getThreadSource({ channel, post, }: {
    channel: db.Channel;
    post: db.Post;
}): {
    source: ub.Source;
    sourceId: string;
};
export declare function getRootSourceFromChat(chat: db.Chat): {
    source: ub.Source;
    sourceId: string;
};
export declare function adjustVolumeSetting(source: ub.Source, volume: ub.VolumeMap | null): Promise<number>;
export declare function setPushNotificationsSetting(allow: ub.PushNotificationsSetting): Promise<number>;
export declare function getPushNotificationsSetting(): Promise<ub.PushNotificationsSetting>;
export type ActivityUpdateQueue = {
    baseUnread?: db.BaseUnread;
    groupUnreads: db.GroupUnread[];
    channelUnreads: db.ChannelUnread[];
    threadUnreads: db.ThreadUnreadState[];
    volumeUpdates: db.VolumeSettings[];
    volumeRemovals: string[];
    activityEvents: db.ActivityEvent[];
};
export declare const toClientUnreads: (activity: ub.Activity) => db.ActivityInit;
export declare const toGroupUnread: (groupId: string, summary: ub.ActivitySummary) => db.GroupUnread;
export declare const toChannelUnread: (channelId: string, summary: ub.ActivitySummary, type: db.ChannelUnread['type']) => db.ChannelUnread;
export declare const toThreadUnread: (channelId: string, threadId: string, summary: ub.ActivitySummary, type: db.ChannelUnread['type']) => db.ThreadUnreadState;
export {};
//# sourceMappingURL=activityApi.d.ts.map