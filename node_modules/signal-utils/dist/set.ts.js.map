{"version":3,"file":"set.ts.js","sources":["../src/set.ts"],"sourcesContent":["import {\n  createStorage,\n  type StorageMap,\n  type Storage,\n} from \"./-private/util.ts\";\n\nexport class SignalSet<T = unknown> implements Set<T> {\n  private collection = createStorage();\n\n  private storages: StorageMap<T> = new Map();\n\n  private vals: Set<T>;\n\n  private storageFor(key: T): Storage {\n    const storages = this.storages;\n    let storage = storages.get(key);\n\n    if (storage === undefined) {\n      storage = createStorage();\n      storages.set(key, storage);\n    }\n\n    return storage;\n  }\n\n  private dirtyStorageFor(key: T): void {\n    const storage = this.storages.get(key);\n\n    if (storage) {\n      storage.set(null);\n    }\n  }\n\n  constructor();\n  constructor(values: readonly T[] | null);\n  constructor(iterable: Iterable<T>);\n  constructor(existing?: readonly T[] | Iterable<T> | null | undefined) {\n    this.vals = new Set(existing);\n  }\n\n  // **** KEY GETTERS ****\n  has(value: T): boolean {\n    this.storageFor(value).get();\n\n    return this.vals.has(value);\n  }\n\n  // **** ALL GETTERS ****\n  entries(): IterableIterator<[T, T]> {\n    this.collection.get();\n\n    return this.vals.entries();\n  }\n\n  keys(): IterableIterator<T> {\n    this.collection.get();\n\n    return this.vals.keys();\n  }\n\n  values(): IterableIterator<T> {\n    this.collection.get();\n\n    return this.vals.values();\n  }\n\n  forEach(fn: (value1: T, value2: T, set: Set<T>) => void): void {\n    this.collection.get();\n\n    this.vals.forEach(fn);\n  }\n\n  get size(): number {\n    this.collection.get();\n\n    return this.vals.size;\n  }\n\n  [Symbol.iterator](): IterableIterator<T> {\n    this.collection.get();\n\n    return this.vals[Symbol.iterator]();\n  }\n\n  get [Symbol.toStringTag](): string {\n    return this.vals[Symbol.toStringTag];\n  }\n\n  // **** KEY SETTERS ****\n  add(value: T): this {\n    this.dirtyStorageFor(value);\n    this.collection.set(null);\n\n    this.vals.add(value);\n\n    return this;\n  }\n\n  delete(value: T): boolean {\n    this.dirtyStorageFor(value);\n    this.collection.set(null);\n\n    return this.vals.delete(value);\n  }\n\n  // **** ALL SETTERS ****\n  clear(): void {\n    this.storages.forEach((s) => s.set(null));\n    this.collection.set(null);\n\n    this.vals.clear();\n  }\n}\n\n// So instanceof works\nObject.setPrototypeOf(SignalSet.prototype, Set.prototype);\n"],"names":["SignalSet","collection","createStorage","storages","Map","vals","storageFor","key","storage","get","undefined","set","dirtyStorageFor","constructor","existing","Set","has","value","entries","keys","values","forEach","fn","size","Symbol","iterator","toStringTag","add","delete","clear","s","Object","setPrototypeOf","prototype"],"mappings":"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"}