{"version":3,"file":"weak-set.ts.js","sources":["../src/weak-set.ts"],"sourcesContent":["import {\n  createStorage,\n  type StorageWeakMap,\n  type Storage,\n} from \"./-private/util.ts\";\n\nexport class SignalWeakSet<T extends object = object> implements WeakSet<T> {\n  private storages: StorageWeakMap<T> = new WeakMap();\n\n  private vals: WeakSet<T>;\n\n  private storageFor(key: T): Storage {\n    const storages = this.storages;\n    let storage = storages.get(key);\n\n    if (storage === undefined) {\n      storage = createStorage();\n      storages.set(key, storage);\n    }\n\n    return storage;\n  }\n\n  private dirtyStorageFor(key: T): void {\n    const storage = this.storages.get(key);\n\n    if (storage) {\n      storage.set(null);\n    }\n  }\n\n  constructor(values?: readonly T[] | null) {\n    this.vals = new WeakSet(values);\n  }\n\n  has(value: T): boolean {\n    this.storageFor(value).get();\n\n    return this.vals.has(value);\n  }\n\n  add(value: T): this {\n    // Add to vals first to get better error message\n    this.vals.add(value);\n\n    this.dirtyStorageFor(value);\n\n    return this;\n  }\n\n  delete(value: T): boolean {\n    this.dirtyStorageFor(value);\n\n    return this.vals.delete(value);\n  }\n\n  get [Symbol.toStringTag](): string {\n    return this.vals[Symbol.toStringTag];\n  }\n}\n\n// So instanceof works\nObject.setPrototypeOf(SignalWeakSet.prototype, WeakSet.prototype);\n"],"names":["SignalWeakSet","storages","WeakMap","vals","storageFor","key","storage","get","undefined","createStorage","set","dirtyStorageFor","constructor","values","WeakSet","has","value","add","delete","Symbol","toStringTag","Object","setPrototypeOf","prototype"],"mappings":";;AAMO,MAAMA,aAAa,CAAkD;AAClEC,EAAAA,QAAQ,GAAsB,IAAIC,OAAO,EAAE,CAAA;EAE3CC,IAAI,CAAA;EAEJC,UAAUA,CAACC,GAAM,EAAW;AAClC,IAAA,MAAMJ,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAAA;AAC9B,IAAA,IAAIK,OAAO,GAAGL,QAAQ,CAACM,GAAG,CAACF,GAAG,CAAC,CAAA;IAE/B,IAAIC,OAAO,KAAKE,SAAS,EAAE;MACzBF,OAAO,GAAGG,aAAa,EAAE,CAAA;AACzBR,MAAAA,QAAQ,CAACS,GAAG,CAACL,GAAG,EAAEC,OAAO,CAAC,CAAA;AAC5B,KAAA;AAEA,IAAA,OAAOA,OAAO,CAAA;AAChB,GAAA;EAEQK,eAAeA,CAACN,GAAM,EAAQ;IACpC,MAAMC,OAAO,GAAG,IAAI,CAACL,QAAQ,CAACM,GAAG,CAACF,GAAG,CAAC,CAAA;AAEtC,IAAA,IAAIC,OAAO,EAAE;AACXA,MAAAA,OAAO,CAACI,GAAG,CAAC,IAAI,CAAC,CAAA;AACnB,KAAA;AACF,GAAA;EAEAE,WAAWA,CAACC,MAA4B,EAAE;AACxC,IAAA,IAAI,CAACV,IAAI,GAAG,IAAIW,OAAO,CAACD,MAAM,CAAC,CAAA;AACjC,GAAA;EAEAE,GAAGA,CAACC,KAAQ,EAAW;IACrB,IAAI,CAACZ,UAAU,CAACY,KAAK,CAAC,CAACT,GAAG,EAAE,CAAA;AAE5B,IAAA,OAAO,IAAI,CAACJ,IAAI,CAACY,GAAG,CAACC,KAAK,CAAC,CAAA;AAC7B,GAAA;EAEAC,GAAGA,CAACD,KAAQ,EAAQ;AAClB;AACA,IAAA,IAAI,CAACb,IAAI,CAACc,GAAG,CAACD,KAAK,CAAC,CAAA;AAEpB,IAAA,IAAI,CAACL,eAAe,CAACK,KAAK,CAAC,CAAA;AAE3B,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEAE,MAAMA,CAACF,KAAQ,EAAW;AACxB,IAAA,IAAI,CAACL,eAAe,CAACK,KAAK,CAAC,CAAA;AAE3B,IAAA,OAAO,IAAI,CAACb,IAAI,CAACe,MAAM,CAACF,KAAK,CAAC,CAAA;AAChC,GAAA;EAEA,KAAKG,MAAM,CAACC,WAAW,CAAY,GAAA;AACjC,IAAA,OAAO,IAAI,CAACjB,IAAI,CAACgB,MAAM,CAACC,WAAW,CAAC,CAAA;AACtC,GAAA;AACF,CAAA;;AAEA;AACAC,MAAM,CAACC,cAAc,CAACtB,aAAa,CAACuB,SAAS,EAAET,OAAO,CAACS,SAAS,CAAC;;;;"}