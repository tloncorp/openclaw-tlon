{"version":3,"file":"weak-map.ts.js","sources":["../src/weak-map.ts"],"sourcesContent":["import { createStorage, type StorageWeakMap } from \"./-private/util.ts\";\n\nexport class SignalWeakMap<K extends object = object, V = unknown>\n  implements WeakMap<K, V>\n{\n  private storages: StorageWeakMap<K> = new WeakMap();\n\n  private vals: WeakMap<K, V>;\n\n  private readStorageFor(key: K): void {\n    const { storages } = this;\n    let storage = storages.get(key);\n\n    if (storage === undefined) {\n      storage = createStorage();\n      storages.set(key, storage);\n    }\n\n    storage.get();\n  }\n\n  private dirtyStorageFor(key: K): void {\n    const storage = this.storages.get(key);\n\n    if (storage) {\n      storage.set(null);\n    }\n  }\n\n  constructor();\n  constructor(iterable: Iterable<readonly [K, V]>);\n  constructor(entries: readonly [K, V][] | null);\n  constructor(\n    existing?: readonly [K, V][] | Iterable<readonly [K, V]> | null | undefined,\n  ) {\n    // TypeScript doesn't correctly resolve the overloads for calling the `Map`\n    // constructor for the no-value constructor. This resolves that.\n    this.vals = existing ? new WeakMap(existing) : new WeakMap();\n  }\n\n  get(key: K): V | undefined {\n    this.readStorageFor(key);\n\n    return this.vals.get(key);\n  }\n\n  has(key: K): boolean {\n    this.readStorageFor(key);\n\n    return this.vals.has(key);\n  }\n\n  set(key: K, value: V): this {\n    this.dirtyStorageFor(key);\n\n    this.vals.set(key, value);\n\n    return this;\n  }\n\n  delete(key: K): boolean {\n    this.dirtyStorageFor(key);\n\n    return this.vals.delete(key);\n  }\n\n  get [Symbol.toStringTag](): string {\n    return this.vals[Symbol.toStringTag];\n  }\n}\n\n// So instanceof works\nObject.setPrototypeOf(SignalWeakMap.prototype, WeakMap.prototype);\n"],"names":["SignalWeakMap","storages","WeakMap","vals","readStorageFor","key","storage","get","undefined","createStorage","set","dirtyStorageFor","constructor","existing","has","value","delete","Symbol","toStringTag","Object","setPrototypeOf","prototype"],"mappings":";;AAEO,MAAMA,aAAa,CAE1B;AACUC,EAAAA,QAAQ,GAAsB,IAAIC,OAAO,EAAE,CAAA;EAE3CC,IAAI,CAAA;EAEJC,cAAcA,CAACC,GAAM,EAAQ;IACnC,MAAM;AAAEJ,MAAAA,QAAAA;AAAS,KAAC,GAAG,IAAI,CAAA;AACzB,IAAA,IAAIK,OAAO,GAAGL,QAAQ,CAACM,GAAG,CAACF,GAAG,CAAC,CAAA;IAE/B,IAAIC,OAAO,KAAKE,SAAS,EAAE;MACzBF,OAAO,GAAGG,aAAa,EAAE,CAAA;AACzBR,MAAAA,QAAQ,CAACS,GAAG,CAACL,GAAG,EAAEC,OAAO,CAAC,CAAA;AAC5B,KAAA;IAEAA,OAAO,CAACC,GAAG,EAAE,CAAA;AACf,GAAA;EAEQI,eAAeA,CAACN,GAAM,EAAQ;IACpC,MAAMC,OAAO,GAAG,IAAI,CAACL,QAAQ,CAACM,GAAG,CAACF,GAAG,CAAC,CAAA;AAEtC,IAAA,IAAIC,OAAO,EAAE;AACXA,MAAAA,OAAO,CAACI,GAAG,CAAC,IAAI,CAAC,CAAA;AACnB,KAAA;AACF,GAAA;EAKAE,WAAWA,CACTC,QAA2E,EAC3E;AACA;AACA;AACA,IAAA,IAAI,CAACV,IAAI,GAAGU,QAAQ,GAAG,IAAIX,OAAO,CAACW,QAAQ,CAAC,GAAG,IAAIX,OAAO,EAAE,CAAA;AAC9D,GAAA;EAEAK,GAAGA,CAACF,GAAM,EAAiB;AACzB,IAAA,IAAI,CAACD,cAAc,CAACC,GAAG,CAAC,CAAA;AAExB,IAAA,OAAO,IAAI,CAACF,IAAI,CAACI,GAAG,CAACF,GAAG,CAAC,CAAA;AAC3B,GAAA;EAEAS,GAAGA,CAACT,GAAM,EAAW;AACnB,IAAA,IAAI,CAACD,cAAc,CAACC,GAAG,CAAC,CAAA;AAExB,IAAA,OAAO,IAAI,CAACF,IAAI,CAACW,GAAG,CAACT,GAAG,CAAC,CAAA;AAC3B,GAAA;AAEAK,EAAAA,GAAGA,CAACL,GAAM,EAAEU,KAAQ,EAAQ;AAC1B,IAAA,IAAI,CAACJ,eAAe,CAACN,GAAG,CAAC,CAAA;IAEzB,IAAI,CAACF,IAAI,CAACO,GAAG,CAACL,GAAG,EAAEU,KAAK,CAAC,CAAA;AAEzB,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;EAEAC,MAAMA,CAACX,GAAM,EAAW;AACtB,IAAA,IAAI,CAACM,eAAe,CAACN,GAAG,CAAC,CAAA;AAEzB,IAAA,OAAO,IAAI,CAACF,IAAI,CAACa,MAAM,CAACX,GAAG,CAAC,CAAA;AAC9B,GAAA;EAEA,KAAKY,MAAM,CAACC,WAAW,CAAY,GAAA;AACjC,IAAA,OAAO,IAAI,CAACf,IAAI,CAACc,MAAM,CAACC,WAAW,CAAC,CAAA;AACtC,GAAA;AACF,CAAA;;AAEA;AACAC,MAAM,CAACC,cAAc,CAACpB,aAAa,CAACqB,SAAS,EAAEnB,OAAO,CAACmB,SAAS,CAAC;;;;"}