services:
  openclaw:
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - ../.env
    ports:
      - "18789:18789"
    volumes:
      # Mount plugin repo
      - ..:/workspace/openclaw-tlon
      # Container-local node_modules (avoids host darwin binaries overwriting linux)
      - openclaw-tlon-modules:/workspace/openclaw-tlon/node_modules
      # Mount tlonbot for config and prompts
      - ../../tlonbot:/workspace/tlonbot
      # Optional: mount api-beta for local development (comment out to use npm)
      - ../../api-beta:/workspace/api-beta
      # Note: tlon-skill is installed from npm, no mount needed
      # Persist OpenClaw state
      - openclaw-state:/root/.openclaw
      # Config from tlonbot
      - ../../tlonbot/openclaw.json:/root/.openclaw/openclaw.json:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  openclaw-state:
  openclaw-tlon-modules: